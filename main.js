!function(){"use strict";var e=class{constructor(e,t){this._inputSelector=e.inputSelector,this._submitButtonSelector=e.submitButtonSelector,this._inactiveButtonClass=e.inactiveButtonClass,this._inputErrorClass=e.inputErrorClass,this._errorClass=e.errorClass,this._form=t}_showInputError(e){const t=this._form.querySelector(`#${e.id}-error`);e.classList.add(this._inputErrorClass),t.textContent=e.validationMessage,t.classList.add(this._errorClass)}_hideInputError(e){const t=this._form.querySelector(`#${e.id}-error`);e.classList.remove(this._inputErrorClass),t.textContent=" ",t.classList.remove(this._errorClass)}_toggleButtonState(){this._hasInvalidInput()?this.disableButton():this._enableButton()}_hasInvalidInput(){return!this._inputList.every((e=>e.validity.valid))}_checkInputValidity(e){e.validity.valid?this._hideInputError(e):this._showInputError(e)}disableButton(){this._submitButton.classList.add(this._inactiveButtonClass),this._submitButton.disabled=!0}_enableButton(){this._submitButton.classList.remove(this._inactiveButtonClass),this._submitButton.disabled=!1}_setEventListeners(){this._inputList=[...this._form.querySelectorAll(this._inputSelector)],this._submitButton=this._form.querySelector(this._submitButtonSelector),this._inputList.forEach((e=>{e.addEventListener("input",(t=>{this._checkInputValidity(e),this._toggleButtonState()}))}))}enableValidation(){this._form.addEventListener("submit",(e=>{e.preventDefault()})),this._setEventListeners()}};class t{constructor(e){let{popupSelector:t}=e;this._popupElement=document.querySelector(t)}open(){this._popupElement.classList.add("modal_opened"),document.addEventListener("keydown",this._handleEscClose)}close(){this._popupElement.classList.remove("modal_opened"),document.removeEventListener("keydown",this._handleEscClose)}_handleEscClose=e=>{"Escape"===e.key&&this.close()};setEventListeners(){this._popupElement.querySelector(".modal__button-reset").addEventListener("click",(()=>this.close())),this._popupElement.addEventListener("click",(e=>{e.target.matches(".modal")&&this.close()}))}}class s extends t{constructor(e,t){let{handleSubmit:s,buttonText:o,loadingButtonText:i}=t;super({popupSelector:e}),this._popupForm=this._popupElement.querySelector(".modal__form"),this._handleSubmit=s,this._inputs=this._popupForm.querySelectorAll(".modal__input"),this._buttonText=o,this._loadingButtonText=i,this._popupSubmitButton=this._popupElement.querySelector(".modal__button")}_getInputValues(){const e={};return this._inputs.forEach((t=>{e[t.name]=t.value})),e}setEventListeners(){this._popupForm.addEventListener("submit",(e=>{e.preventDefault(),this._handleSubmit(this._getInputValues())})),super.setEventListeners()}close(){this._popupForm.reset(),super.close()}hideLoading(){this._popupSubmitButton.textContent=this._buttonText}showLoading(){this._popupSubmitButton.textContent=this._loadingButtonText}}const o=document.querySelector(".profile__edit-button"),i=document.querySelector("#profile-popup"),n=i.querySelector(".modal__form"),r=(i.querySelector(".modal__button-reset"),document.querySelector("#name")),a=document.querySelector("#description"),l=(document.querySelector(".profile__title"),document.querySelector(".profile__description"),document.querySelector(".profile__add-button")),d=document.querySelector("#add-card-popup"),u=(d.querySelector(".modal__button-reset"),d.querySelector(".modal__form")),c=(document.querySelector("#title"),document.querySelector("#image"),document.querySelector("#picture-popup"),document.querySelector(".cards__list"),{inputSelector:".modal__input",submitButtonSelector:".modal__button",inactiveButtonClass:"modal__button_disabled",inputErrorClass:"modal__input_type_error",errorClass:"popup__error_visible"}),h=(document.querySelector(".profile__image"),document.querySelector(".card__trash-button"),document.querySelector(".profile__image-button")),_=(document.querySelector(".profile__title"),document.querySelector(".profile__description"),document.querySelector("#change-pic-form")),p=document.querySelector("#delete-card-form");class m{constructor(e,t){let{items:s,renderer:o}=e;this._items=s,this._renderer=o,this._container=document.querySelector(t)}renderItems(){this._items.forEach((e=>{const t=this._renderer(e);this.addItem(t)}))}addItem(e){this._container.prepend(e)}}let S;const b=new e(c,n),v=new e(c,u),L=new e(c,_),y=new e(c,p);b.enableValidation(),v.enableValidation(),L.enableValidation(),y.enableValidation();const E=new class extends t{open(e){let{link:t,name:s}=e;const o=this._popupElement.querySelector(".modal__image-clicked"),i=this._popupElement.querySelector(".modal__image-text");o.src=t,i.alt=s,i.textContent=s,super.open()}}({popupSelector:"#picture-popup"});E.setEventListeners();const g=new class extends t{constructor(e,t){let{buttonText:s,loadingButtonText:o}=t;super({popupSelector:e}),this._popupForm=this._popupElement.querySelector(".modal__form"),this._popupConfirmationButton=this._popupForm.querySelector(".modal__button"),this._buttonText=s,this._loadingButtonText=o}setEventListeners(){this._popupForm.addEventListener("submit",(e=>{e.preventDefault(),this._handleConfirmation()})),super.setEventListeners()}setSubmitAction(e){this._handleConfirmation=e}showLoading(){this._popupConfirmationButton.textContent=this._loadingButtonText}hideLoading(){this._popupConfirmationButton.textContent=this._buttonText}close(){this._popupForm.reset(),super.close()}}("#delete-card",{buttonText:"Yes",loadingButtonText:"Deleting..."});g.setEventListeners();const f=new class{constructor(e){let{baseUrl:t,authorizationID:s}=e;this._baseUrl=t,this._header={authorization:s,"Content-Type":"application/json"}}_processResponseServer=e=>e.ok?e.json():Promise.reject(`Error: ${e.status}`);getUserInformation(){return fetch(`${this._baseUrl}users/me`,{headers:this._header}).then(this._processResponseServer)}getInitialCards(){return fetch(`${this._baseUrl}cards`,{headers:this._header}).then(this._processResponseServer)}editProfile(e){let{name:t,about:s}=e;return fetch(`${this._baseUrl}users/me`,{method:"PATCH",headers:this._header,body:JSON.stringify({name:t,about:s})}).then(this._processResponseServer)}addNewCard(e){let{name:t,link:s}=e;return fetch(`${this._baseUrl}cards`,{method:"POST",headers:this._header,body:JSON.stringify({name:t,link:s})}).then(this._processResponseServer)}deleteCard(e){return fetch(`${this._baseUrl}cards/${e}`,{method:"DELETE",headers:this._header}).then(this._processResponseServer)}updateProfPic(e){return fetch(`${this._baseUrl}users/me/avatar`,{method:"PATCH",headers:this._header,body:JSON.stringify({avatar:e})}).then(this._processResponseServer)}addLike(e){return fetch(`${this._baseUrl}cards/likes/${e}`,{method:"PUT",headers:this._header}).then(this._processResponseServer)}removeLike(e){return fetch(`${this._baseUrl}cards/likes/${e}`,{method:"DELETE",headers:this._header}).then(this._processResponseServer)}}({baseUrl:"https://around.nomoreparties.co/v1/group-12/",authorizationID:"3d5d45c7-6b7d-40fa-b3ac-6d464d71f592"});let k;Promise.all([f.getUserInformation(),f.getInitialCards()]).then((e=>{let[t,s]=e;T.setUserInfo(t.name,t.about),T.setAvatar(t.avatar),k=t._id,S=new m({items:s,renderer:e=>B(e,e.owner._id===k)},".cards__list"),S.renderItems()})).catch((e=>console.log(e)));const C=e=>{g.setSubmitAction((()=>{g.showLoading(),f.deleteCard(e.id).then((()=>{g.close(),e.removeCard()})).catch((e=>console.log(e))).finally((()=>{g.hideLoading()}))})),g.open()},q=e=>{e.isLiked()?f.removeLike(e.id).then((t=>{e.updateLikes(t.likes)})).catch((e=>console.log(e))):f.addLike(e.id).then((t=>{e.updateLikes(t.likes)})).catch((e=>console.log(e)))},B=e=>new class{constructor(e,t,s,o,i,n,r){this._text=e.name,this._link=e.link,this.id=e._id,this._userId=t,this._isOwner=s,this._likes=e.likes,this._cardSelector=o,this._handleCardClick=i,this._handleDeleteCard=n,this._handleLikeButton=r}_setEventListeners(){this._element.querySelector(".card__like-button").addEventListener("click",(()=>this._handleLikeButton(this))),this._trashButton=this._element.querySelector(".card__trash-button"),this._trashButton.addEventListener("click",(()=>this._handleDeleteCard(this))),this._element.querySelector(".card__image").addEventListener("click",(()=>this._handleCardClick({name:this._text,link:this._link})))}like(){this._element.querySelector(".card__like-button").classList.add("card__like-button_active")}unlike(){this._element.querySelector(".card__like-button").classList.remove("card__like-button_active")}isLiked(){return this._likes.find((e=>{let{_id:t}=e;return this._userId===t}))}updateLikes(e){this._likes=e,this.renderLikes()}renderLikes(){this._element.querySelector(".card__like-number").textContent=this._likes.length,this.isLiked(this._userId)?this.like():this.unlike()}_getTemplate(){return document.querySelector(this._cardSelector).content.querySelector(".card").cloneNode(!0)}getView(){this._element=this._getTemplate(),this._setEventListeners();const e=this._element.querySelector(".card__image"),t=this._element.querySelector(".card__text");return this.renderLikes(),e.src=this._link,e.alt=this._text,t.textContent=this._text,this._isOwner&&this._trashButton.classList.add("card__trash_visible"),this._element}removeCard(){this._element.remove(),this._element.null}}(e,k,e.owner._id===k,".template",(e=>{E.open(e)}),C,q).getView(),x=new s("#profile-popup",{handleSubmit:e=>{x.showLoading(),f.editProfile({name:e.name,about:e.description}).then((e=>{T.setUserInfo(e.name,e.about),x.close()})).catch((e=>console.log(e))).finally((()=>{x.hideLoading()}))},buttonText:"Save",loadingButtonText:"Saving.."}),w=new s("#add-card-popup",{handleSubmit:e=>{w.showLoading(),f.addNewCard({name:e.title,link:e.image}).then((e=>{const t=B(e);S.addItem(t),w.close()})).catch((e=>console.log(e))).finally((()=>{w.hideLoading()}))},buttonText:"Create",loadingButtonText:"Creating..."}),I=new s("#change-profile-pic",{handleSubmit:e=>{I.showLoading(),f.updateProfPic(e.image).then((e=>{T.setAvatar(e.avatar),I.close()})).catch((e=>console.log(e))).finally((()=>{I.hideLoading()}))},buttonText:"Save",loadingButtonText:"Saving.."});h.addEventListener("click",(()=>{L.disableButton(),I.open()}));const T=new class{constructor(e){let{nameSelector:t,jobSelector:s,avatarSelector:o}=e;this._nameElement=document.querySelector(t),this._jobElement=document.querySelector(s),this._avatarElement=document.querySelector(o)}getUserInfo(){return{name:this._nameElement.textContent,description:this._jobElement.textContent}}setUserInfo(e,t){this._nameElement.textContent=e,this._jobElement.textContent=t}setAvatar(e){this._avatarElement.src=e}}({nameSelector:".profile__title",jobSelector:".profile__description",avatarSelector:".profile__image"});w.setEventListeners(),x.setEventListeners(),I.setEventListeners(),l.addEventListener("click",(()=>{w.open(),v.disableButton()})),o.addEventListener("click",(()=>{b.disableButton(),x.open();const e=T.getUserInfo();r.value=e.name,a.value=e.description}))}();
//# sourceMappingURL=data:application/json;charset=utf-8;base64,eyJ2ZXJzaW9uIjozLCJmaWxlIjoibWFpbi5qcyIsIm1hcHBpbmdzIjoieUJBMEVBLE1BMUVBLE1BQ0VBLFlBQVlDLEVBQVVDLEdBQ3BCQyxLQUFLQyxlQUFpQkgsRUFBU0ksY0FDL0JGLEtBQUtHLHNCQUF3QkwsRUFBU00scUJBQ3RDSixLQUFLSyxxQkFBdUJQLEVBQVNRLG9CQUNyQ04sS0FBS08saUJBQW1CVCxFQUFTVSxnQkFDakNSLEtBQUtTLFlBQWNYLEVBQVNZLFdBRTVCVixLQUFLVyxNQUFRWixDQUNmLENBRUFhLGdCQUFnQkMsR0FDZCxNQUFNQyxFQUFpQmQsS0FBS1csTUFBTUksY0FBZSxJQUFHRixFQUFRRyxZQUM1REgsRUFBUUksVUFBVUMsSUFBSWxCLEtBQUtPLGtCQUMzQk8sRUFBZUssWUFBY04sRUFBUU8sa0JBQ3JDTixFQUFlRyxVQUFVQyxJQUFJbEIsS0FBS1MsWUFDcEMsQ0FFQVksZ0JBQWdCUixHQUNkLE1BQU1DLEVBQWlCZCxLQUFLVyxNQUFNSSxjQUFlLElBQUdGLEVBQVFHLFlBQzVESCxFQUFRSSxVQUFVSyxPQUFPdEIsS0FBS08sa0JBQzlCTyxFQUFlSyxZQUFjLElBQzdCTCxFQUFlRyxVQUFVSyxPQUFPdEIsS0FBS1MsWUFDdkMsQ0FFQWMscUJBQ012QixLQUFLd0IsbUJBQ1B4QixLQUFLeUIsZ0JBRUx6QixLQUFLMEIsZUFFVCxDQUVBRixtQkFDRSxPQUFReEIsS0FBSzJCLFdBQVdDLE9BQU9mLEdBQVlBLEVBQVFnQixTQUFTQyxPQUM5RCxDQUVBQyxvQkFBb0JsQixHQUNiQSxFQUFRZ0IsU0FBU0MsTUFHcEI5QixLQUFLcUIsZ0JBQWdCUixHQUZyQmIsS0FBS1ksZ0JBQWdCQyxFQUl6QixDQUVBWSxnQkFDRXpCLEtBQUtnQyxjQUFjZixVQUFVQyxJQUFJbEIsS0FBS0ssc0JBQ3RDTCxLQUFLZ0MsY0FBY0MsVUFBVyxDQUNoQyxDQUVBUCxnQkFDRTFCLEtBQUtnQyxjQUFjZixVQUFVSyxPQUFPdEIsS0FBS0ssc0JBQ3pDTCxLQUFLZ0MsY0FBY0MsVUFBVyxDQUNoQyxDQUVBQyxxQkFDRWxDLEtBQUsyQixXQUFhLElBQUkzQixLQUFLVyxNQUFNd0IsaUJBQWlCbkMsS0FBS0MsaUJBQ3ZERCxLQUFLZ0MsY0FBZ0JoQyxLQUFLVyxNQUFNSSxjQUFjZixLQUFLRyx1QkFDbkRILEtBQUsyQixXQUFXUyxTQUFTdkIsSUFDdkJBLEVBQVF3QixpQkFBaUIsU0FBVUMsSUFDakN0QyxLQUFLK0Isb0JBQW9CbEIsR0FDekJiLEtBQUt1QixvQkFBb0IsR0FDekIsR0FFTixDQUVBZ0IsbUJBQ0V2QyxLQUFLVyxNQUFNMEIsaUJBQWlCLFVBQVdDLElBQ3JDQSxFQUFFRSxnQkFBZ0IsSUFFcEJ4QyxLQUFLa0Msb0JBQ1AsR0N2RWEsTUFBTU8sRUFDbkI1QyxZQUFXNkMsR0FBb0IsSUFBbkIsY0FBRUMsR0FBZUQsRUFDM0IxQyxLQUFLNEMsY0FBZ0JDLFNBQVM5QixjQUFjNEIsRUFDOUMsQ0FFQUcsT0FDRTlDLEtBQUs0QyxjQUFjM0IsVUFBVUMsSUFBSSxnQkFDakMyQixTQUFTUixpQkFBaUIsVUFBV3JDLEtBQUsrQyxnQkFDNUMsQ0FFQUMsUUFDRWhELEtBQUs0QyxjQUFjM0IsVUFBVUssT0FBTyxnQkFDcEN1QixTQUFTSSxvQkFBb0IsVUFBV2pELEtBQUsrQyxnQkFDL0MsQ0FFQUEsZ0JBQW1CRyxJQUNELFdBQVpBLEVBQUlDLEtBQ05uRCxLQUFLZ0QsT0FDUCxFQUdGSSxvQkFDMkJwRCxLQUFLNEMsY0FBYzdCLGNBQzFDLHdCQUVlc0IsaUJBQWlCLFNBQVMsSUFBTXJDLEtBQUtnRCxVQUV0RGhELEtBQUs0QyxjQUFjUCxpQkFBaUIsU0FBVWEsSUFDeENBLEVBQUlHLE9BQU9DLFFBQVEsV0FDckJ0RCxLQUFLZ0QsT0FDUCxHQUVKLEVDOUJhLE1BQU1PLFVBQXNCZCxFQUN6QzVDLFlBQVk4QyxFQUFhRCxHQUFtRCxJQUFqRCxhQUFFYyxFQUFZLFdBQUVDLEVBQVUsa0JBQUVDLEdBQW1CaEIsRUFDeEVpQixNQUFNLENBQUVoQixrQkFDUjNDLEtBQUs0RCxXQUFhNUQsS0FBSzRDLGNBQWM3QixjQUFjLGdCQUNuRGYsS0FBSzZELGNBQWdCTCxFQUNyQnhELEtBQUs4RCxRQUFVOUQsS0FBSzRELFdBQVd6QixpQkFBaUIsaUJBQ2hEbkMsS0FBSytELFlBQWNOLEVBQ25CekQsS0FBS2dFLG1CQUFxQk4sRUFDMUIxRCxLQUFLaUUsbUJBQ0hqRSxLQUFLNEMsY0FBYzdCLGNBQWMsaUJBQ3JDLENBRUFtRCxrQkFDRSxNQUFNQyxFQUFjLENBQUMsRUFJckIsT0FIQW5FLEtBQUs4RCxRQUFRMUIsU0FBU2dDLElBQ3BCRCxFQUFZQyxFQUFNQyxNQUFRRCxFQUFNRSxLQUFLLElBRWhDSCxDQUNULENBRUFmLG9CQUNFcEQsS0FBSzRELFdBQVd2QixpQkFBaUIsVUFBV2EsSUFDMUNBLEVBQUlWLGlCQUNKeEMsS0FBSzZELGNBQWM3RCxLQUFLa0Usa0JBQWtCLElBRTVDUCxNQUFNUCxtQkFDUixDQUVBSixRQUNFaEQsS0FBSzRELFdBQVdXLFFBQ2hCWixNQUFNWCxPQUNSLENBRUF3QixjQUNFeEUsS0FBS2lFLG1CQUFtQjlDLFlBQWNuQixLQUFLK0QsV0FDN0MsQ0FFQVUsY0FDRXpFLEtBQUtpRSxtQkFBbUI5QyxZQUFjbkIsS0FBS2dFLGtCQUM3QyxFQ3pDSyxNQTJCTVUsRUFBb0I3QixTQUFTOUIsY0FDeEMseUJBRVc0RCxFQUFlOUIsU0FBUzlCLGNBQWMsa0JBQ3RDNkQsRUFBcUJELEVBQWE1RCxjQUFjLGdCQUloRDhELEdBSHFCRixFQUFhNUQsY0FDN0Msd0JBRXVCOEIsU0FBUzlCLGNBQWMsVUFDbkMrRCxFQUFXakMsU0FBUzlCLGNBQWMsZ0JBR2xDZ0UsR0FGY2xDLFNBQVM5QixjQUFjLG1CQUN4QjhCLFNBQVM5QixjQUFjLHlCQUNqQjhCLFNBQVM5QixjQUFjLHlCQUUxQ2lFLEVBQWVuQyxTQUFTOUIsY0FBYyxtQkFJdENrRSxHQUgwQkQsRUFBYWpFLGNBQ2xELHdCQUU4QmlFLEVBQWFqRSxjQUFjLGlCQU05Q21FLEdBTGFyQyxTQUFTOUIsY0FBYyxVQUN2QjhCLFNBQVM5QixjQUFjLFVBRXJCOEIsU0FBUzlCLGNBQWMsa0JBQzFCOEIsU0FBUzlCLGNBQWMsZ0JBQ2QsQ0FDaENiLGNBQWUsZ0JBQ2ZFLHFCQUFzQixpQkFDdEJFLG9CQUFxQix5QkFDckJFLGdCQUFpQiwwQkFDakJFLFdBQVkseUJBSUR5RSxHQUZldEMsU0FBUzlCLGNBQWMsbUJBQ3hCOEIsU0FBUzlCLGNBQWMsdUJBQ2hCOEIsU0FBUzlCLGNBQ3pDLDJCQU1XcUUsR0FKZXZDLFNBQVM5QixjQUFjLG1CQUNqQjhCLFNBQVM5QixjQUN6Qyx5QkFFMkI4QixTQUFTOUIsY0FBYyxxQkFDdkNzRSxFQUFpQnhDLFNBQVM5QixjQUFjLHFCQ3BFdEMsTUFBTXVFLEVBQ25CekYsWUFBVzZDLEVBQXNCNkMsR0FBVyxJQUFoQyxNQUFFQyxFQUFLLFNBQUVDLEdBQVUvQyxFQUM3QjFDLEtBQUswRixPQUFTRixFQUNkeEYsS0FBSzJGLFVBQVlGLEVBQ2pCekYsS0FBSzRGLFdBQWEvQyxTQUFTOUIsY0FBY3dFLEVBQzNDLENBRUFNLGNBQ0U3RixLQUFLMEYsT0FBT3RELFNBQVMwRCxJQUNuQixNQUFNQyxFQUFVL0YsS0FBSzJGLFVBQVVHLEdBQy9COUYsS0FBS2dHLFFBQVFELEVBQVEsR0FFekIsQ0FFQUMsUUFBUUQsR0FDTi9GLEtBQUs0RixXQUFXSyxRQUFRRixFQUMxQixFQ21CRixJQUFJRyxFQUVKLE1BQU1DLEVBQW9CLElBQUlDLEVBQzVCbEIsRUFDQU4sR0FFSXlCLEVBQW1CLElBQUlELEVBQzNCbEIsRUFDQUQsR0FHSXFCLEVBQXFCLElBQUlGLEVBQWNsQixFQUFvQkUsR0FFM0RtQixFQUFzQixJQUFJSCxFQUM5QmxCLEVBQ0FHLEdBR0ZjLEVBQWtCNUQsbUJBQ2xCOEQsRUFBaUI5RCxtQkFDakIrRCxFQUFtQi9ELG1CQUNuQmdFLEVBQW9CaEUsbUJBd0JwQixNQUFNaUUsRUFBYSxJQy9FSixjQUE2Qi9ELEVBQzFDSyxLQUFJSixHQUFpQixJQUFoQixLQUFFK0QsRUFBSSxLQUFFcEMsR0FBTTNCLEVBQ2pCLE1BQU1nRSxFQUFRMUcsS0FBSzRDLGNBQWM3QixjQUFjLHlCQUN6QzRGLEVBQVkzRyxLQUFLNEMsY0FBYzdCLGNBQWMsc0JBQ25EMkYsRUFBTUUsSUFBTUgsRUFDWkUsRUFBVUUsSUFBTXhDLEVBQ2hCc0MsRUFBVXhGLFlBQWNrRCxFQUN4QlYsTUFBTWIsTUFDUixHRHVFb0MsQ0FBRUgsY0FBZSxtQkFDdkQ2RCxFQUFXcEQsb0JBRVgsTUFBTTBELEVBQWMsSUVqRkwsY0FBb0NyRSxFQUNqRDVDLFlBQVk4QyxFQUFhRCxHQUFxQyxJQUFuQyxXQUFFZSxFQUFVLGtCQUFFQyxHQUFtQmhCLEVBQzFEaUIsTUFBTSxDQUFFaEIsa0JBQ1IzQyxLQUFLNEQsV0FBYTVELEtBQUs0QyxjQUFjN0IsY0FBYyxnQkFDbkRmLEtBQUsrRyx5QkFDSC9HLEtBQUs0RCxXQUFXN0MsY0FBYyxrQkFDaENmLEtBQUsrRCxZQUFjTixFQUNuQnpELEtBQUtnRSxtQkFBcUJOLENBQzVCLENBRUFOLG9CQUNFcEQsS0FBSzRELFdBQVd2QixpQkFBaUIsVUFBV2EsSUFDMUNBLEVBQUlWLGlCQUNKeEMsS0FBS2dILHFCQUFxQixJQUU1QnJELE1BQU1QLG1CQUNSLENBRUE2RCxnQkFBZ0JDLEdBQ2RsSCxLQUFLZ0gsb0JBQXNCRSxDQUM3QixDQUVBekMsY0FDRXpFLEtBQUsrRyx5QkFBeUI1RixZQUFjbkIsS0FBS2dFLGtCQUNuRCxDQUVBUSxjQUNFeEUsS0FBSytHLHlCQUF5QjVGLFlBQWNuQixLQUFLK0QsV0FDbkQsQ0FFQWYsUUFDRWhELEtBQUs0RCxXQUFXVyxRQUNoQlosTUFBTVgsT0FDUixHRmdENEMsZUFBZ0IsQ0FDNURTLFdBQVksTUFDWkMsa0JBQW1CLGdCQUVyQm9ELEVBQVkxRCxvQkFFWixNQUFNK0QsRUFBTSxJR3pGRyxNQUNidEgsWUFBVzZDLEdBQStCLElBQTlCLFFBQUUwRSxFQUFPLGdCQUFFQyxHQUFpQjNFLEVBQ3RDMUMsS0FBS3NILFNBQVdGLEVBQ2hCcEgsS0FBS3VILFFBQVUsQ0FDYkMsY0FBZUgsRUFDZixlQUFnQixtQkFFcEIsQ0FFQUksdUJBQTBCQyxHQUNwQkEsRUFBSUMsR0FDQ0QsRUFBSUUsT0FFTkMsUUFBUUMsT0FBUSxVQUFTSixFQUFJSyxVQUd0Q0MscUJBQ0UsT0FBT0MsTUFBTyxHQUFFakksS0FBS3NILG1CQUFvQixDQUN2Q1ksUUFBU2xJLEtBQUt1SCxVQUNiWSxLQUFLbkksS0FBS3lILHVCQUNmLENBRUFXLGtCQUNFLE9BQU9ILE1BQU8sR0FBRWpJLEtBQUtzSCxnQkFBaUIsQ0FDcENZLFFBQVNsSSxLQUFLdUgsVUFDYlksS0FBS25JLEtBQUt5SCx1QkFDZixDQUVBWSxZQUFXQyxHQUFrQixJQUFqQixLQUFFakUsRUFBSSxNQUFFa0UsR0FBT0QsRUFDekIsT0FBT0wsTUFBTyxHQUFFakksS0FBS3NILG1CQUFvQixDQUN2Q2tCLE9BQVEsUUFDUk4sUUFBU2xJLEtBQUt1SCxRQUNka0IsS0FBTUMsS0FBS0MsVUFBVSxDQUNuQnRFLE9BQ0FrRSxZQUVESixLQUFLbkksS0FBS3lILHVCQUNmLENBRUFtQixXQUFVQyxHQUFpQixJQUFoQixLQUFFeEUsRUFBSSxLQUFFb0MsR0FBTW9DLEVBQ3ZCLE9BQU9aLE1BQU8sR0FBRWpJLEtBQUtzSCxnQkFBaUIsQ0FDcENrQixPQUFRLE9BQ1JOLFFBQVNsSSxLQUFLdUgsUUFDZGtCLEtBQU1DLEtBQUtDLFVBQVUsQ0FDbkJ0RSxPQUNBb0MsV0FFRDBCLEtBQUtuSSxLQUFLeUgsdUJBQ2YsQ0FFQXFCLFdBQVc5SCxHQUNULE9BQU9pSCxNQUFPLEdBQUVqSSxLQUFLc0gsaUJBQWlCdEcsSUFBTSxDQUMxQ3dILE9BQVEsU0FDUk4sUUFBU2xJLEtBQUt1SCxVQUNiWSxLQUFLbkksS0FBS3lILHVCQUNmLENBRUFzQixjQUFjQyxHQUNaLE9BQU9mLE1BQU8sR0FBRWpJLEtBQUtzSCwwQkFBMkIsQ0FDOUNrQixPQUFRLFFBQ1JOLFFBQVNsSSxLQUFLdUgsUUFDZGtCLEtBQU1DLEtBQUtDLFVBQVUsQ0FDbkJLLGFBRURiLEtBQUtuSSxLQUFLeUgsdUJBQ2YsQ0FFQXdCLFFBQVFqSSxHQUNOLE9BQU9pSCxNQUFPLEdBQUVqSSxLQUFLc0gsdUJBQXVCdEcsSUFBTSxDQUNoRHdILE9BQVEsTUFDUk4sUUFBU2xJLEtBQUt1SCxVQUNiWSxLQUFLbkksS0FBS3lILHVCQUNmLENBRUF5QixXQUFXbEksR0FDVCxPQUFPaUgsTUFBTyxHQUFFakksS0FBS3NILHVCQUF1QnRHLElBQU0sQ0FDaER3SCxPQUFRLFNBQ1JOLFFBQVNsSSxLQUFLdUgsVUFDYlksS0FBS25JLEtBQUt5SCx1QkFDZixHSFVrQixDQUNsQkwsUUFBUywrQ0FDVEMsZ0JBQWlCLHlDQUduQixJQUFJOEIsRUFFSnRCLFFBQVF1QixJQUFJLENBQUNqQyxFQUFJYSxxQkFBc0JiLEVBQUlpQixvQkFDeENELE1BQUt6RixJQUFtQixJQUFqQjJHLEVBQU1DLEdBQU01RyxFQUNsQjZHLEVBQVNDLFlBQVlILEVBQUtoRixLQUFNZ0YsRUFBS2QsT0FDckNnQixFQUFTRSxVQUFVSixFQUFLTCxRQUN4QkcsRUFBU0UsRUFBS0ssSUFFZHhELEVBQWMsSUFBSVosRUFDaEIsQ0FDRUUsTUFBTzhELEVBQ1A3RCxTQUFXSyxHQUFTNkQsRUFBVzdELEVBQU1BLEVBQUs4RCxNQUFNRixNQUFRUCxJQUUxRCxnQkFHRmpELEVBQVlMLGFBQWEsSUFFMUJnRSxPQUFPQyxHQUFRQyxRQUFRQyxJQUFJRixLQUU5QixNQUFNRyxFQUFxQkMsSUFDekJwRCxFQUFZRyxpQkFBZ0IsS0FDMUJILEVBQVlyQyxjQUNaMEMsRUFDRzJCLFdBQVdvQixFQUFLbEosSUFDaEJtSCxNQUFLLEtBQ0pyQixFQUFZOUQsUUFDWmtILEVBQUtDLFlBQVksSUFFbEJOLE9BQU9DLEdBQVFDLFFBQVFDLElBQUlGLEtBQzNCTSxTQUFRLEtBQ1B0RCxFQUFZdEMsYUFBYSxHQUN6QixJQUVOc0MsRUFBWWhFLE1BQU0sRUFHZHVILEVBQW9CSCxJQUNwQkEsRUFBS0ksVUFDUG5ELEVBQ0crQixXQUFXZ0IsRUFBS2xKLElBQ2hCbUgsTUFBTVQsSUFDTHdDLEVBQUtLLFlBQVk3QyxFQUFJOEMsTUFBTSxJQUU1QlgsT0FBT0MsR0FBUUMsUUFBUUMsSUFBSUYsS0FFOUIzQyxFQUNHOEIsUUFBUWlCLEVBQUtsSixJQUNibUgsTUFBTVQsSUFDTHdDLEVBQUtLLFlBQVk3QyxFQUFJOEMsTUFBTSxJQUU1QlgsT0FBT0MsR0FBUUMsUUFBUUMsSUFBSUYsSUFDaEMsRUFHSUgsRUFBY2MsR0FDTCxJSXRKZixNQUNFNUssWUFDRTZLLEVBQ0F2QixFQUNBd0IsRUFDQUMsRUFDQUMsRUFDQUMsRUFDQVQsR0FFQXJLLEtBQUsrSyxNQUFRTCxFQUFLckcsS0FDbEJyRSxLQUFLZ0wsTUFBUU4sRUFBS2pFLEtBQ2xCekcsS0FBS2dCLEdBQUswSixFQUFLaEIsSUFDZjFKLEtBQUtpTCxRQUFVOUIsRUFDZm5KLEtBQUtrTCxTQUFXUCxFQUNoQjNLLEtBQUttTCxPQUFTVCxFQUFLRixNQUNuQnhLLEtBQUtvTCxjQUFnQlIsRUFDckI1SyxLQUFLcUwsaUJBQW1CUixFQUN4QjdLLEtBQUtzTCxrQkFBb0JSLEVBQ3pCOUssS0FBS3VMLGtCQUFvQmxCLENBQzNCLENBRUFuSSxxQkFDRWxDLEtBQUt3TCxTQUNGekssY0FBYyxzQkFDZHNCLGlCQUFpQixTQUFTLElBQU1yQyxLQUFLdUwsa0JBQWtCdkwsUUFFMURBLEtBQUt5TCxhQUFlekwsS0FBS3dMLFNBQVN6SyxjQUFjLHVCQUNoRGYsS0FBS3lMLGFBQWFwSixpQkFBaUIsU0FBUyxJQUMxQ3JDLEtBQUtzTCxrQkFBa0J0TCxRQUd6QkEsS0FBS3dMLFNBQ0Z6SyxjQUFjLGdCQUNkc0IsaUJBQWlCLFNBQVMsSUFDekJyQyxLQUFLcUwsaUJBQWlCLENBQUVoSCxLQUFNckUsS0FBSytLLE1BQU90RSxLQUFNekcsS0FBS2dMLFNBRTNELENBRUFVLE9BQ0UxTCxLQUFLd0wsU0FDRnpLLGNBQWMsc0JBQ2RFLFVBQVVDLElBQUksMkJBQ25CLENBRUF5SyxTQUNFM0wsS0FBS3dMLFNBQ0Z6SyxjQUFjLHNCQUNkRSxVQUFVSyxPQUFPLDJCQUN0QixDQUVBZ0osVUFDRSxPQUFPdEssS0FBS21MLE9BQU9TLE1BQUtsSixJQUFBLElBQUMsSUFBRWdILEdBQUtoSCxFQUFBLE9BQUsxQyxLQUFLaUwsVUFBWXZCLENBQUcsR0FDM0QsQ0FFQWEsWUFBWUMsR0FDVnhLLEtBQUttTCxPQUFTWCxFQUNkeEssS0FBSzZMLGFBQ1AsQ0FFQUEsY0FDeUI3TCxLQUFLd0wsU0FBU3pLLGNBQWMsc0JBQ3BDSSxZQUFjbkIsS0FBS21MLE9BQU9XLE9BQ3JDOUwsS0FBS3NLLFFBQVF0SyxLQUFLaUwsU0FDcEJqTCxLQUFLMEwsT0FFTDFMLEtBQUsyTCxRQUVULENBRUFJLGVBQ0UsT0FBT2xKLFNBQ0o5QixjQUFjZixLQUFLb0wsZUFDbkJZLFFBQVFqTCxjQUFjLFNBQ3RCa0wsV0FBVSxFQUNmLENBRUFDLFVBQ0VsTSxLQUFLd0wsU0FBV3hMLEtBQUsrTCxlQUNyQi9MLEtBQUtrQyxxQkFDTCxNQUFNaUssRUFBWW5NLEtBQUt3TCxTQUFTekssY0FBYyxnQkFDeENxTCxFQUFXcE0sS0FBS3dMLFNBQVN6SyxjQUFjLGVBUTdDLE9BUEFmLEtBQUs2TCxjQUNMTSxFQUFVdkYsSUFBTTVHLEtBQUtnTCxNQUNyQm1CLEVBQVV0RixJQUFNN0csS0FBSytLLE1BQ3JCcUIsRUFBU2pMLFlBQWNuQixLQUFLK0ssTUFDeEIvSyxLQUFLa0wsVUFDUGxMLEtBQUt5TCxhQUFheEssVUFBVUMsSUFBSSx1QkFFM0JsQixLQUFLd0wsUUFDZCxDQUVBckIsYUFDRW5LLEtBQUt3TCxTQUFTbEssU0FDZHRCLEtBQUt3TCxTQUFTYSxJQUNoQixHSndERTVCLEVBQ0F0QixFQUNBc0IsRUFBU2IsTUFBTUYsTUFBUVAsRUFDdkIsYUFDQ3VCLElBQ0NsRSxFQUFXMUQsS0FBSzRILEVBQUssR0FFdkJULEVBQ0FJLEdBRVU2QixVQUdSdkgsRUFBZSxJQUFJcEIsRUFBYyxpQkFBa0IsQ0FDdkRDLGFBQWU4SSxJQUNiM0gsRUFBYUYsY0FDYjBDLEVBQ0drQixZQUFZLENBQUVoRSxLQUFNaUksRUFBWWpJLEtBQU1rRSxNQUFPK0QsRUFBWUMsY0FDekRwRSxNQUFNVCxJQUNMNkIsRUFBU0MsWUFBWTlCLEVBQUlyRCxLQUFNcUQsRUFBSWEsT0FDbkM1RCxFQUFhM0IsT0FBTyxJQUVyQjZHLE9BQU9DLEdBQVFDLFFBQVFDLElBQUlGLEtBQzNCTSxTQUFRLEtBQ1B6RixFQUFhSCxhQUFhLEdBQzFCLEVBRU5mLFdBQVksT0FDWkMsa0JBQW1CLGFBR2Y4SSxFQUFZLElBQUlqSixFQUFjLGtCQUFtQixDQUNyREMsYUFBZThJLElBQ2JFLEVBQVUvSCxjQUNWMEMsRUFDR3lCLFdBQVcsQ0FBRXZFLEtBQU1pSSxFQUFZRyxNQUFPaEcsS0FBTTZGLEVBQVk1RixRQUN4RHlCLE1BQU1ULElBQ0wsTUFBTXdDLEVBQU9QLEVBQVdqQyxHQUN4QnhCLEVBQVlGLFFBQVFrRSxHQUNwQnNDLEVBQVV4SixPQUFPLElBRWxCNkcsT0FBT0MsR0FBUUMsUUFBUUMsSUFBSUYsS0FDM0JNLFNBQVEsS0FDUG9DLEVBQVVoSSxhQUFhLEdBQ3ZCLEVBRU5mLFdBQVksU0FDWkMsa0JBQW1CLGdCQUtmZ0osRUFBaUIsSUFBSW5KLEVBQWMsc0JBQXVCLENBQzlEQyxhQUFlbUosSUFDYkQsRUFBZWpJLGNBQ2YwQyxFQUNHNEIsY0FBYzRELEVBQVdqRyxPQUN6QnlCLE1BQU1ULElBRUw2QixFQUFTRSxVQUFVL0IsRUFBSXNCLFFBQ3ZCMEQsRUFBZTFKLE9BQU8sSUFFdkI2RyxPQUFPQyxHQUFRQyxRQUFRQyxJQUFJRixLQUMzQk0sU0FBUSxLQUNQc0MsRUFBZWxJLGFBQWEsR0FDNUIsRUFFTmYsV0FBWSxPQUNaQyxrQkFBbUIsYUFHckJ5QixFQUFtQjlDLGlCQUFpQixTQUFTLEtBQzNDaUUsRUFBbUI3RSxnQkFDbkJpTCxFQUFlNUosTUFBTSxJQUt2QixNQUFNeUcsRUFBVyxJS3JPRixNQUNiMUosWUFBVzZDLEdBQWdELElBQS9DLGFBQUVrSyxFQUFZLFlBQUVDLEVBQVcsZUFBRUMsR0FBZ0JwSyxFQUN2RDFDLEtBQUsrTSxhQUFlbEssU0FBUzlCLGNBQWM2TCxHQUMzQzVNLEtBQUtnTixZQUFjbkssU0FBUzlCLGNBQWM4TCxHQUMxQzdNLEtBQUtpTixlQUFpQnBLLFNBQVM5QixjQUFjK0wsRUFDL0MsQ0FFQUksY0FLRSxNQUppQixDQUNmN0ksS0FBTXJFLEtBQUsrTSxhQUFhNUwsWUFDeEJvTCxZQUFhdk0sS0FBS2dOLFlBQVk3TCxZQUdsQyxDQUVBcUksWUFBWW5GLEVBQU04SSxHQUNoQm5OLEtBQUsrTSxhQUFhNUwsWUFBY2tELEVBQ2hDckUsS0FBS2dOLFlBQVk3TCxZQUFjZ00sQ0FDakMsQ0FFQTFELFVBQVVULEdBQ1JoSixLQUFLaU4sZUFBZXJHLElBQU1vQyxDQUM1QixHTCtNNEIsQ0FDNUI0RCxhQUFjLGtCQUNkQyxZQUFhLHdCQUNiQyxlQUFnQixvQkFHbEJOLEVBQVVwSixvQkFDVnVCLEVBQWF2QixvQkFDYnNKLEVBQWV0SixvQkFFZjJCLEVBQWlCMUMsaUJBQWlCLFNBQVMsS0FDekNtSyxFQUFVMUosT0FDVnVELEVBQWlCNUUsZUFBZSxJQUVsQ2lELEVBQWtCckMsaUJBQWlCLFNBQVMsS0FDMUM4RCxFQUFrQjFFLGdCQUNsQmtELEVBQWE3QixPQUNiLE1BQU1zSyxFQUFXN0QsRUFBUzJELGNBQzFCckksRUFBVVAsTUFBUThJLEVBQVMvSSxLQUMzQlMsRUFBU1IsTUFBUThJLEVBQVNiLFdBQVcsRyIsInNvdXJjZXMiOlsid2VicGFjazovL3ByYWN0aWN1bS8uL3NyYy9jb21wb25lbnRzL0Zvcm1WYWxpZGF0b3IuanMiLCJ3ZWJwYWNrOi8vcHJhY3RpY3VtLy4vc3JjL2NvbXBvbmVudHMvUG9wdXAuanMiLCJ3ZWJwYWNrOi8vcHJhY3RpY3VtLy4vc3JjL2NvbXBvbmVudHMvUG9wdXBXaXRoRm9ybS5qcyIsIndlYnBhY2s6Ly9wcmFjdGljdW0vLi9zcmMvdXRpbHMvY29uc3RhbnRzLmpzIiwid2VicGFjazovL3ByYWN0aWN1bS8uL3NyYy9jb21wb25lbnRzL1NlY3Rpb24uanMiLCJ3ZWJwYWNrOi8vcHJhY3RpY3VtLy4vc3JjL3BhZ2VzL2luZGV4LmpzIiwid2VicGFjazovL3ByYWN0aWN1bS8uL3NyYy9jb21wb25lbnRzL1BvcHVwV2l0aEltYWdlLmpzIiwid2VicGFjazovL3ByYWN0aWN1bS8uL3NyYy9jb21wb25lbnRzL1BvcHVwV2l0aENvbmZpcm1hdGlvbi5qcyIsIndlYnBhY2s6Ly9wcmFjdGljdW0vLi9zcmMvdXRpbHMvQXBpLmpzIiwid2VicGFjazovL3ByYWN0aWN1bS8uL3NyYy9jb21wb25lbnRzL0NhcmQuanMiLCJ3ZWJwYWNrOi8vcHJhY3RpY3VtLy4vc3JjL2NvbXBvbmVudHMvVXNlckluZm8uanMiXSwic291cmNlc0NvbnRlbnQiOlsiY2xhc3MgRm9ybVZhbGlkYXRvciB7XHJcbiAgY29uc3RydWN0b3Ioc2V0dGluZ3MsIGZvcm1FbGVtZW50KSB7XHJcbiAgICB0aGlzLl9pbnB1dFNlbGVjdG9yID0gc2V0dGluZ3MuaW5wdXRTZWxlY3RvcjtcclxuICAgIHRoaXMuX3N1Ym1pdEJ1dHRvblNlbGVjdG9yID0gc2V0dGluZ3Muc3VibWl0QnV0dG9uU2VsZWN0b3I7XHJcbiAgICB0aGlzLl9pbmFjdGl2ZUJ1dHRvbkNsYXNzID0gc2V0dGluZ3MuaW5hY3RpdmVCdXR0b25DbGFzcztcclxuICAgIHRoaXMuX2lucHV0RXJyb3JDbGFzcyA9IHNldHRpbmdzLmlucHV0RXJyb3JDbGFzcztcclxuICAgIHRoaXMuX2Vycm9yQ2xhc3MgPSBzZXR0aW5ncy5lcnJvckNsYXNzO1xyXG5cclxuICAgIHRoaXMuX2Zvcm0gPSBmb3JtRWxlbWVudDtcclxuICB9XHJcblxyXG4gIF9zaG93SW5wdXRFcnJvcihpbnB1dEVsKSB7XHJcbiAgICBjb25zdCBlcnJvck1lc3NhZ2VFbCA9IHRoaXMuX2Zvcm0ucXVlcnlTZWxlY3RvcihgIyR7aW5wdXRFbC5pZH0tZXJyb3JgKTtcclxuICAgIGlucHV0RWwuY2xhc3NMaXN0LmFkZCh0aGlzLl9pbnB1dEVycm9yQ2xhc3MpO1xyXG4gICAgZXJyb3JNZXNzYWdlRWwudGV4dENvbnRlbnQgPSBpbnB1dEVsLnZhbGlkYXRpb25NZXNzYWdlO1xyXG4gICAgZXJyb3JNZXNzYWdlRWwuY2xhc3NMaXN0LmFkZCh0aGlzLl9lcnJvckNsYXNzKTtcclxuICB9XHJcblxyXG4gIF9oaWRlSW5wdXRFcnJvcihpbnB1dEVsKSB7XHJcbiAgICBjb25zdCBlcnJvck1lc3NhZ2VFbCA9IHRoaXMuX2Zvcm0ucXVlcnlTZWxlY3RvcihgIyR7aW5wdXRFbC5pZH0tZXJyb3JgKTtcclxuICAgIGlucHV0RWwuY2xhc3NMaXN0LnJlbW92ZSh0aGlzLl9pbnB1dEVycm9yQ2xhc3MpO1xyXG4gICAgZXJyb3JNZXNzYWdlRWwudGV4dENvbnRlbnQgPSBcIiBcIjtcclxuICAgIGVycm9yTWVzc2FnZUVsLmNsYXNzTGlzdC5yZW1vdmUodGhpcy5fZXJyb3JDbGFzcyk7XHJcbiAgfVxyXG5cclxuICBfdG9nZ2xlQnV0dG9uU3RhdGUoKSB7XHJcbiAgICBpZiAodGhpcy5faGFzSW52YWxpZElucHV0KCkpIHtcclxuICAgICAgdGhpcy5kaXNhYmxlQnV0dG9uKCk7XHJcbiAgICB9IGVsc2Uge1xyXG4gICAgICB0aGlzLl9lbmFibGVCdXR0b24oKTtcclxuICAgIH1cclxuICB9XHJcblxyXG4gIF9oYXNJbnZhbGlkSW5wdXQoKSB7XHJcbiAgICByZXR1cm4gIXRoaXMuX2lucHV0TGlzdC5ldmVyeSgoaW5wdXRFbCkgPT4gaW5wdXRFbC52YWxpZGl0eS52YWxpZCk7XHJcbiAgfVxyXG5cclxuICBfY2hlY2tJbnB1dFZhbGlkaXR5KGlucHV0RWwpIHtcclxuICAgIGlmICghaW5wdXRFbC52YWxpZGl0eS52YWxpZCkge1xyXG4gICAgICB0aGlzLl9zaG93SW5wdXRFcnJvcihpbnB1dEVsKTtcclxuICAgIH0gZWxzZSB7XHJcbiAgICAgIHRoaXMuX2hpZGVJbnB1dEVycm9yKGlucHV0RWwpO1xyXG4gICAgfVxyXG4gIH1cclxuXHJcbiAgZGlzYWJsZUJ1dHRvbigpIHtcclxuICAgIHRoaXMuX3N1Ym1pdEJ1dHRvbi5jbGFzc0xpc3QuYWRkKHRoaXMuX2luYWN0aXZlQnV0dG9uQ2xhc3MpO1xyXG4gICAgdGhpcy5fc3VibWl0QnV0dG9uLmRpc2FibGVkID0gdHJ1ZTtcclxuICB9XHJcblxyXG4gIF9lbmFibGVCdXR0b24oKSB7XHJcbiAgICB0aGlzLl9zdWJtaXRCdXR0b24uY2xhc3NMaXN0LnJlbW92ZSh0aGlzLl9pbmFjdGl2ZUJ1dHRvbkNsYXNzKTtcclxuICAgIHRoaXMuX3N1Ym1pdEJ1dHRvbi5kaXNhYmxlZCA9IGZhbHNlO1xyXG4gIH1cclxuXHJcbiAgX3NldEV2ZW50TGlzdGVuZXJzKCkge1xyXG4gICAgdGhpcy5faW5wdXRMaXN0ID0gWy4uLnRoaXMuX2Zvcm0ucXVlcnlTZWxlY3RvckFsbCh0aGlzLl9pbnB1dFNlbGVjdG9yKV07XHJcbiAgICB0aGlzLl9zdWJtaXRCdXR0b24gPSB0aGlzLl9mb3JtLnF1ZXJ5U2VsZWN0b3IodGhpcy5fc3VibWl0QnV0dG9uU2VsZWN0b3IpO1xyXG4gICAgdGhpcy5faW5wdXRMaXN0LmZvckVhY2goKGlucHV0RWwpID0+IHtcclxuICAgICAgaW5wdXRFbC5hZGRFdmVudExpc3RlbmVyKFwiaW5wdXRcIiwgKGUpID0+IHtcclxuICAgICAgICB0aGlzLl9jaGVja0lucHV0VmFsaWRpdHkoaW5wdXRFbCk7XHJcbiAgICAgICAgdGhpcy5fdG9nZ2xlQnV0dG9uU3RhdGUoKTtcclxuICAgICAgfSk7XHJcbiAgICB9KTtcclxuICB9XHJcblxyXG4gIGVuYWJsZVZhbGlkYXRpb24oKSB7XHJcbiAgICB0aGlzLl9mb3JtLmFkZEV2ZW50TGlzdGVuZXIoXCJzdWJtaXRcIiwgKGUpID0+IHtcclxuICAgICAgZS5wcmV2ZW50RGVmYXVsdCgpO1xyXG4gICAgfSk7XHJcbiAgICB0aGlzLl9zZXRFdmVudExpc3RlbmVycygpO1xyXG4gIH1cclxufVxyXG5cclxuZXhwb3J0IGRlZmF1bHQgRm9ybVZhbGlkYXRvcjtcclxuIiwiZXhwb3J0IGRlZmF1bHQgY2xhc3MgUG9wdXAge1xyXG4gIGNvbnN0cnVjdG9yKHsgcG9wdXBTZWxlY3RvciB9KSB7XHJcbiAgICB0aGlzLl9wb3B1cEVsZW1lbnQgPSBkb2N1bWVudC5xdWVyeVNlbGVjdG9yKHBvcHVwU2VsZWN0b3IpO1xyXG4gIH1cclxuXHJcbiAgb3BlbigpIHtcclxuICAgIHRoaXMuX3BvcHVwRWxlbWVudC5jbGFzc0xpc3QuYWRkKFwibW9kYWxfb3BlbmVkXCIpO1xyXG4gICAgZG9jdW1lbnQuYWRkRXZlbnRMaXN0ZW5lcihcImtleWRvd25cIiwgdGhpcy5faGFuZGxlRXNjQ2xvc2UpO1xyXG4gIH1cclxuXHJcbiAgY2xvc2UoKSB7XHJcbiAgICB0aGlzLl9wb3B1cEVsZW1lbnQuY2xhc3NMaXN0LnJlbW92ZShcIm1vZGFsX29wZW5lZFwiKTtcclxuICAgIGRvY3VtZW50LnJlbW92ZUV2ZW50TGlzdGVuZXIoXCJrZXlkb3duXCIsIHRoaXMuX2hhbmRsZUVzY0Nsb3NlKTtcclxuICB9XHJcblxyXG4gIF9oYW5kbGVFc2NDbG9zZSA9IChldnQpID0+IHtcclxuICAgIGlmIChldnQua2V5ID09PSBcIkVzY2FwZVwiKSB7XHJcbiAgICAgIHRoaXMuY2xvc2UoKTtcclxuICAgIH1cclxuICB9O1xyXG5cclxuICBzZXRFdmVudExpc3RlbmVycygpIHtcclxuICAgIGNvbnN0IG1vZGFsQnV0dG9uUmVzZXQgPSB0aGlzLl9wb3B1cEVsZW1lbnQucXVlcnlTZWxlY3RvcihcclxuICAgICAgXCIubW9kYWxfX2J1dHRvbi1yZXNldFwiXHJcbiAgICApO1xyXG4gICAgbW9kYWxCdXR0b25SZXNldC5hZGRFdmVudExpc3RlbmVyKFwiY2xpY2tcIiwgKCkgPT4gdGhpcy5jbG9zZSgpKTtcclxuXHJcbiAgICB0aGlzLl9wb3B1cEVsZW1lbnQuYWRkRXZlbnRMaXN0ZW5lcihcImNsaWNrXCIsIChldnQpID0+IHtcclxuICAgICAgaWYgKGV2dC50YXJnZXQubWF0Y2hlcyhcIi5tb2RhbFwiKSkge1xyXG4gICAgICAgIHRoaXMuY2xvc2UoKTtcclxuICAgICAgfVxyXG4gICAgfSk7XHJcbiAgfVxyXG59XHJcbiIsImltcG9ydCBQb3B1cCBmcm9tIFwiLi9Qb3B1cC5qc1wiO1xyXG5cclxuZXhwb3J0IGRlZmF1bHQgY2xhc3MgUG9wdXBXaXRoRm9ybSBleHRlbmRzIFBvcHVwIHtcclxuICBjb25zdHJ1Y3Rvcihwb3B1cFNlbGVjdG9yLCB7IGhhbmRsZVN1Ym1pdCwgYnV0dG9uVGV4dCwgbG9hZGluZ0J1dHRvblRleHQgfSkge1xyXG4gICAgc3VwZXIoeyBwb3B1cFNlbGVjdG9yIH0pO1xyXG4gICAgdGhpcy5fcG9wdXBGb3JtID0gdGhpcy5fcG9wdXBFbGVtZW50LnF1ZXJ5U2VsZWN0b3IoXCIubW9kYWxfX2Zvcm1cIik7XHJcbiAgICB0aGlzLl9oYW5kbGVTdWJtaXQgPSBoYW5kbGVTdWJtaXQ7XHJcbiAgICB0aGlzLl9pbnB1dHMgPSB0aGlzLl9wb3B1cEZvcm0ucXVlcnlTZWxlY3RvckFsbChcIi5tb2RhbF9faW5wdXRcIik7XHJcbiAgICB0aGlzLl9idXR0b25UZXh0ID0gYnV0dG9uVGV4dDtcclxuICAgIHRoaXMuX2xvYWRpbmdCdXR0b25UZXh0ID0gbG9hZGluZ0J1dHRvblRleHQ7XHJcbiAgICB0aGlzLl9wb3B1cFN1Ym1pdEJ1dHRvbiA9XHJcbiAgICAgIHRoaXMuX3BvcHVwRWxlbWVudC5xdWVyeVNlbGVjdG9yKFwiLm1vZGFsX19idXR0b25cIik7XHJcbiAgfVxyXG5cclxuICBfZ2V0SW5wdXRWYWx1ZXMoKSB7XHJcbiAgICBjb25zdCBpbnB1dE9iamVjdCA9IHt9O1xyXG4gICAgdGhpcy5faW5wdXRzLmZvckVhY2goKGlucHV0KSA9PiB7XHJcbiAgICAgIGlucHV0T2JqZWN0W2lucHV0Lm5hbWVdID0gaW5wdXQudmFsdWU7XHJcbiAgICB9KTtcclxuICAgIHJldHVybiBpbnB1dE9iamVjdDtcclxuICB9XHJcblxyXG4gIHNldEV2ZW50TGlzdGVuZXJzKCkge1xyXG4gICAgdGhpcy5fcG9wdXBGb3JtLmFkZEV2ZW50TGlzdGVuZXIoXCJzdWJtaXRcIiwgKGV2dCkgPT4ge1xyXG4gICAgICBldnQucHJldmVudERlZmF1bHQoKTtcclxuICAgICAgdGhpcy5faGFuZGxlU3VibWl0KHRoaXMuX2dldElucHV0VmFsdWVzKCkpO1xyXG4gICAgfSk7XHJcbiAgICBzdXBlci5zZXRFdmVudExpc3RlbmVycygpO1xyXG4gIH1cclxuXHJcbiAgY2xvc2UoKSB7XHJcbiAgICB0aGlzLl9wb3B1cEZvcm0ucmVzZXQoKTtcclxuICAgIHN1cGVyLmNsb3NlKCk7XHJcbiAgfVxyXG5cclxuICBoaWRlTG9hZGluZygpIHtcclxuICAgIHRoaXMuX3BvcHVwU3VibWl0QnV0dG9uLnRleHRDb250ZW50ID0gdGhpcy5fYnV0dG9uVGV4dDtcclxuICB9XHJcblxyXG4gIHNob3dMb2FkaW5nKCkge1xyXG4gICAgdGhpcy5fcG9wdXBTdWJtaXRCdXR0b24udGV4dENvbnRlbnQgPSB0aGlzLl9sb2FkaW5nQnV0dG9uVGV4dDtcclxuICB9XHJcbn1cclxuIiwiZXhwb3J0IGNvbnN0IGluaXRpYWxDYXJkcyA9IFtcclxuICB7XHJcbiAgICBuYW1lOiBcIllvc2VtaXRlIFZhbGxleVwiLFxyXG4gICAgbGluazogXCJodHRwczovL3ByYWN0aWN1bS1jb250ZW50LnMzLnVzLXdlc3QtMS5hbWF6b25hd3MuY29tL3NvZnR3YXJlLWVuZ2luZWVyL2Fyb3VuZC1wcm9qZWN0L3lvc2VtaXRlLmpwZ1wiLFxyXG4gIH0sXHJcbiAge1xyXG4gICAgbmFtZTogXCJMYWtlIExvdWlzZVwiLFxyXG4gICAgbGluazogXCJodHRwczovL3ByYWN0aWN1bS1jb250ZW50LnMzLnVzLXdlc3QtMS5hbWF6b25hd3MuY29tL3NvZnR3YXJlLWVuZ2luZWVyL2Fyb3VuZC1wcm9qZWN0L2xha2UtbG91aXNlLmpwZ1wiLFxyXG4gIH0sXHJcbiAge1xyXG4gICAgbmFtZTogXCJCYWxkIE1vdW50YWluc1wiLFxyXG4gICAgbGluazogXCJodHRwczovL3ByYWN0aWN1bS1jb250ZW50LnMzLnVzLXdlc3QtMS5hbWF6b25hd3MuY29tL3NvZnR3YXJlLWVuZ2luZWVyL2Fyb3VuZC1wcm9qZWN0L2JhbGQtbW91bnRhaW5zLmpwZ1wiLFxyXG4gIH0sXHJcbiAge1xyXG4gICAgbmFtZTogXCJMYXRlbWFyXCIsXHJcbiAgICBsaW5rOiBcImh0dHBzOi8vcHJhY3RpY3VtLWNvbnRlbnQuczMudXMtd2VzdC0xLmFtYXpvbmF3cy5jb20vc29mdHdhcmUtZW5naW5lZXIvYXJvdW5kLXByb2plY3QvbGF0ZW1hci5qcGdcIixcclxuICB9LFxyXG4gIHtcclxuICAgIG5hbWU6IFwiVmFub2lzZSBOYXRpb25hbCBQYXJrXCIsXHJcbiAgICBsaW5rOiBcImh0dHBzOi8vcHJhY3RpY3VtLWNvbnRlbnQuczMudXMtd2VzdC0xLmFtYXpvbmF3cy5jb20vc29mdHdhcmUtZW5naW5lZXIvYXJvdW5kLXByb2plY3QvdmFub2lzZS5qcGdcIixcclxuICB9LFxyXG4gIHtcclxuICAgIG5hbWU6IFwiTGFnbyBkaSBCcmFpZXNcIixcclxuICAgIGxpbms6IFwiaHR0cHM6Ly9wcmFjdGljdW0tY29udGVudC5zMy51cy13ZXN0LTEuYW1hem9uYXdzLmNvbS9zb2Z0d2FyZS1lbmdpbmVlci9hcm91bmQtcHJvamVjdC9sYWdvLmpwZ1wiLFxyXG4gIH0sXHJcbl07XHJcblxyXG5leHBvcnQgY29uc3QgcHJvZmlsZUVkaXRCdXR0b24gPSBkb2N1bWVudC5xdWVyeVNlbGVjdG9yKFxyXG4gIFwiLnByb2ZpbGVfX2VkaXQtYnV0dG9uXCJcclxuKTtcclxuZXhwb3J0IGNvbnN0IHByb2ZpbGVQb3B1cCA9IGRvY3VtZW50LnF1ZXJ5U2VsZWN0b3IoXCIjcHJvZmlsZS1wb3B1cFwiKTtcclxuZXhwb3J0IGNvbnN0IHByb2ZpbGVGb3JtRWxlbWVudCA9IHByb2ZpbGVQb3B1cC5xdWVyeVNlbGVjdG9yKFwiLm1vZGFsX19mb3JtXCIpO1xyXG5leHBvcnQgY29uc3QgcHJvZmlsZUJ1dHRvblJlc2V0ID0gcHJvZmlsZVBvcHVwLnF1ZXJ5U2VsZWN0b3IoXHJcbiAgXCIubW9kYWxfX2J1dHRvbi1yZXNldFwiXHJcbik7XHJcbmV4cG9ydCBjb25zdCBuYW1lSW5wdXQgPSBkb2N1bWVudC5xdWVyeVNlbGVjdG9yKFwiI25hbWVcIik7XHJcbmV4cG9ydCBjb25zdCBqb2JJbnB1dCA9IGRvY3VtZW50LnF1ZXJ5U2VsZWN0b3IoXCIjZGVzY3JpcHRpb25cIik7XHJcbmV4cG9ydCBjb25zdCBwcm9maWxlTmFtZSA9IGRvY3VtZW50LnF1ZXJ5U2VsZWN0b3IoXCIucHJvZmlsZV9fdGl0bGVcIik7XHJcbmV4cG9ydCBjb25zdCBwcm9maWxlSm9iID0gZG9jdW1lbnQucXVlcnlTZWxlY3RvcihcIi5wcm9maWxlX19kZXNjcmlwdGlvblwiKTtcclxuZXhwb3J0IGNvbnN0IHByb2ZpbGVBZGRCdXR0b24gPSBkb2N1bWVudC5xdWVyeVNlbGVjdG9yKFwiLnByb2ZpbGVfX2FkZC1idXR0b25cIik7XHJcblxyXG5leHBvcnQgY29uc3QgYWRkQ2FyZFBvcHVwID0gZG9jdW1lbnQucXVlcnlTZWxlY3RvcihcIiNhZGQtY2FyZC1wb3B1cFwiKTtcclxuZXhwb3J0IGNvbnN0IGFkZENhcmRQb3B1cFJlc2V0QnV0dG9uID0gYWRkQ2FyZFBvcHVwLnF1ZXJ5U2VsZWN0b3IoXHJcbiAgXCIubW9kYWxfX2J1dHRvbi1yZXNldFwiXHJcbik7XHJcbmV4cG9ydCBjb25zdCBhZGRDYXJkUG9wdXBGb3JtID0gYWRkQ2FyZFBvcHVwLnF1ZXJ5U2VsZWN0b3IoXCIubW9kYWxfX2Zvcm1cIik7XHJcbmV4cG9ydCBjb25zdCB0aXRsZUlucHV0ID0gZG9jdW1lbnQucXVlcnlTZWxlY3RvcihcIiN0aXRsZVwiKTtcclxuZXhwb3J0IGNvbnN0IGltYWdlSW5wdXQgPSBkb2N1bWVudC5xdWVyeVNlbGVjdG9yKFwiI2ltYWdlXCIpO1xyXG5cclxuZXhwb3J0IGNvbnN0IHBpY3R1cmVQb3B1cCA9IGRvY3VtZW50LnF1ZXJ5U2VsZWN0b3IoXCIjcGljdHVyZS1wb3B1cFwiKTtcclxuZXhwb3J0IGNvbnN0IGNhcmRzTGlzdCA9IGRvY3VtZW50LnF1ZXJ5U2VsZWN0b3IoXCIuY2FyZHNfX2xpc3RcIik7XHJcbmV4cG9ydCBjb25zdCB2YWxpZGF0aW9uU2V0dGluZ3MgPSB7XHJcbiAgaW5wdXRTZWxlY3RvcjogXCIubW9kYWxfX2lucHV0XCIsXHJcbiAgc3VibWl0QnV0dG9uU2VsZWN0b3I6IFwiLm1vZGFsX19idXR0b25cIixcclxuICBpbmFjdGl2ZUJ1dHRvbkNsYXNzOiBcIm1vZGFsX19idXR0b25fZGlzYWJsZWRcIixcclxuICBpbnB1dEVycm9yQ2xhc3M6IFwibW9kYWxfX2lucHV0X3R5cGVfZXJyb3JcIixcclxuICBlcnJvckNsYXNzOiBcInBvcHVwX19lcnJvcl92aXNpYmxlXCIsXHJcbn07XHJcbmV4cG9ydCBjb25zdCBwcm9maWxlSW1hZ2UgPSBkb2N1bWVudC5xdWVyeVNlbGVjdG9yKFwiLnByb2ZpbGVfX2ltYWdlXCIpO1xyXG5leHBvcnQgY29uc3QgdHJhc2hCdXR0b24gPSBkb2N1bWVudC5xdWVyeVNlbGVjdG9yKFwiLmNhcmRfX3RyYXNoLWJ1dHRvblwiKTtcclxuZXhwb3J0IGNvbnN0IHByb2ZpbGVJbWFnZUJ1dHRvbiA9IGRvY3VtZW50LnF1ZXJ5U2VsZWN0b3IoXHJcbiAgXCIucHJvZmlsZV9faW1hZ2UtYnV0dG9uXCJcclxuKTtcclxuZXhwb3J0IGNvbnN0IHByb2ZpbGVUaXRsZSA9IGRvY3VtZW50LnF1ZXJ5U2VsZWN0b3IoXCIucHJvZmlsZV9fdGl0bGVcIik7XHJcbmV4cG9ydCBjb25zdCBwcm9maWxlRGVzY3JpcHRpb24gPSBkb2N1bWVudC5xdWVyeVNlbGVjdG9yKFxyXG4gIFwiLnByb2ZpbGVfX2Rlc2NyaXB0aW9uXCJcclxuKTtcclxuZXhwb3J0IGNvbnN0IGNoYW5nZVBpY0Zvcm0gPSBkb2N1bWVudC5xdWVyeVNlbGVjdG9yKFwiI2NoYW5nZS1waWMtZm9ybVwiKTtcclxuZXhwb3J0IGNvbnN0IGRlbGV0ZUNhcmRGb3JtID0gZG9jdW1lbnQucXVlcnlTZWxlY3RvcihcIiNkZWxldGUtY2FyZC1mb3JtXCIpO1xyXG4iLCJleHBvcnQgZGVmYXVsdCBjbGFzcyBTZWN0aW9uIHtcclxuICBjb25zdHJ1Y3Rvcih7IGl0ZW1zLCByZW5kZXJlciB9LCBjb250YWluZXIpIHtcclxuICAgIHRoaXMuX2l0ZW1zID0gaXRlbXM7XHJcbiAgICB0aGlzLl9yZW5kZXJlciA9IHJlbmRlcmVyO1xyXG4gICAgdGhpcy5fY29udGFpbmVyID0gZG9jdW1lbnQucXVlcnlTZWxlY3Rvcihjb250YWluZXIpO1xyXG4gIH1cclxuXHJcbiAgcmVuZGVySXRlbXMoKSB7XHJcbiAgICB0aGlzLl9pdGVtcy5mb3JFYWNoKChpdGVtKSA9PiB7XHJcbiAgICAgIGNvbnN0IGVsZW1lbnQgPSB0aGlzLl9yZW5kZXJlcihpdGVtKTtcclxuICAgICAgdGhpcy5hZGRJdGVtKGVsZW1lbnQpO1xyXG4gICAgfSk7XHJcbiAgfVxyXG5cclxuICBhZGRJdGVtKGVsZW1lbnQpIHtcclxuICAgIHRoaXMuX2NvbnRhaW5lci5wcmVwZW5kKGVsZW1lbnQpO1xyXG4gIH1cclxufVxyXG4iLCJpbXBvcnQgRm9ybVZhbGlkYXRvciBmcm9tIFwiLi4vY29tcG9uZW50cy9Gb3JtVmFsaWRhdG9yLmpzXCI7XHJcbmltcG9ydCBDYXJkIGZyb20gXCIuLi9jb21wb25lbnRzL0NhcmQuanNcIjtcclxuaW1wb3J0IFBvcHVwV2l0aEZvcm0gZnJvbSBcIi4uL2NvbXBvbmVudHMvUG9wdXBXaXRoRm9ybS5qc1wiO1xyXG5pbXBvcnQgVXNlckluZm8gZnJvbSBcIi4uL2NvbXBvbmVudHMvVXNlckluZm8uanNcIjtcclxuaW1wb3J0IFwiLi4vcGFnZXMvaW5kZXguY3NzXCI7XHJcbmltcG9ydCB7XHJcbiAgaW5pdGlhbENhcmRzLFxyXG4gIHByb2ZpbGVFZGl0QnV0dG9uLFxyXG4gIHByb2ZpbGVGb3JtRWxlbWVudCxcclxuICBwcm9maWxlSW1hZ2UsXHJcbiAgcHJvZmlsZUJ1dHRvblJlc2V0LFxyXG4gIHByb2ZpbGVOYW1lLFxyXG4gIHByb2ZpbGVKb2IsXHJcbiAgcHJvZmlsZUFkZEJ1dHRvbixcclxuICBhZGRDYXJkUG9wdXAsXHJcbiAgYWRkQ2FyZFBvcHVwUmVzZXRCdXR0b24sXHJcbiAgYWRkQ2FyZFBvcHVwRm9ybSxcclxuICBwaWN0dXJlUG9wdXAsXHJcbiAgbmFtZUlucHV0LFxyXG4gIGpvYklucHV0LFxyXG4gIGNhcmRzTGlzdCxcclxuICB2YWxpZGF0aW9uU2V0dGluZ3MsXHJcbiAgdHJhc2hCdXR0b24sXHJcbiAgcHJvZmlsZUltYWdlQnV0dG9uLFxyXG4gIHByb2ZpbGVUaXRsZSxcclxuICBwcm9maWxlRGVzY3JpcHRpb24sXHJcbiAgY2FyZExpa2VOdW1iZXIsXHJcbiAgY2hhbmdlUGljRm9ybSxcclxuICBkZWxldGVDYXJkRm9ybSxcclxufSBmcm9tIFwiLi4vdXRpbHMvY29uc3RhbnRzLmpzXCI7XHJcbmltcG9ydCBQb3B1cFdpdGhJbWFnZSBmcm9tIFwiLi4vY29tcG9uZW50cy9Qb3B1cFdpdGhJbWFnZS5qc1wiO1xyXG5pbXBvcnQgU2VjdGlvbiBmcm9tIFwiLi4vY29tcG9uZW50cy9TZWN0aW9uLmpzXCI7XHJcbmltcG9ydCBBcGkgZnJvbSBcIi4uL3V0aWxzL0FwaS5qc1wiO1xyXG5pbXBvcnQgUG9wdXBXaXRoQ29uZmlybWF0aW9uIGZyb20gXCIuLi9jb21wb25lbnRzL1BvcHVwV2l0aENvbmZpcm1hdGlvbi5qc1wiO1xyXG5cclxubGV0IGNhcmRTZWN0aW9uO1xyXG5cclxuY29uc3QgZWRpdEZvcm1WYWxpZGF0b3IgPSBuZXcgRm9ybVZhbGlkYXRvcihcclxuICB2YWxpZGF0aW9uU2V0dGluZ3MsXHJcbiAgcHJvZmlsZUZvcm1FbGVtZW50XHJcbik7XHJcbmNvbnN0IGFkZEZvcm1WYWxpZGF0b3IgPSBuZXcgRm9ybVZhbGlkYXRvcihcclxuICB2YWxpZGF0aW9uU2V0dGluZ3MsXHJcbiAgYWRkQ2FyZFBvcHVwRm9ybVxyXG4pO1xyXG5cclxuY29uc3QgY2hhbmdlUGljVmFsaWRhdG9yID0gbmV3IEZvcm1WYWxpZGF0b3IodmFsaWRhdGlvblNldHRpbmdzLCBjaGFuZ2VQaWNGb3JtKTtcclxuXHJcbmNvbnN0IGRlbGV0ZUNhcmRWYWxpZGF0b3IgPSBuZXcgRm9ybVZhbGlkYXRvcihcclxuICB2YWxpZGF0aW9uU2V0dGluZ3MsXHJcbiAgZGVsZXRlQ2FyZEZvcm1cclxuKTtcclxuXHJcbmVkaXRGb3JtVmFsaWRhdG9yLmVuYWJsZVZhbGlkYXRpb24oKTtcclxuYWRkRm9ybVZhbGlkYXRvci5lbmFibGVWYWxpZGF0aW9uKCk7XHJcbmNoYW5nZVBpY1ZhbGlkYXRvci5lbmFibGVWYWxpZGF0aW9uKCk7XHJcbmRlbGV0ZUNhcmRWYWxpZGF0b3IuZW5hYmxlVmFsaWRhdGlvbigpO1xyXG5cclxuLypjb25zdCBmb3JtVmFsaWRhdG9ycyA9IHt9O1xyXG5cclxuY29uc3QgZW5hYmxlVmFsaWRhdGlvbiA9IChjb25maWcpID0+IHtcclxuICBjb25zdCBmb3JtTGlzdCA9IEFycmF5LmZyb20oZG9jdW1lbnQucXVlcnlTZWxlY3RvckFsbChjb25maWcuZm9ybVNlbGVjdG9yKSk7XHJcbiAgZm9ybUxpc3QuZm9yRWFjaCgoZm9ybUVsZW1lbnQpID0+IHtcclxuICAgIGNvbnN0IHZhbGlkYXRvciA9IG5ldyBGb3JtVmFsaWRhdG9yKGZvcm1FbGVtZW50LCBjb25maWcpO1xyXG4gICAgY29uc3QgZm9ybU5hbWUgPSBmb3JtRWxlbWVudC5nZXRBdHRyaWJ1dGUoJ25hbWUnKTtcclxuICAgIGZvcm1WYWxpZGF0b3JzW2Zvcm1OYW1lXSA9IHZhbGlkYXRvcjtcclxuICAgIHZhbGlkYXRvci5lbmFibGVWYWxpZGF0aW9uKCk7XHJcbiAgfSk7XHJcbn07XHJcblxyXG5lbmFibGVWYWxpZGF0aW9uKGNvbmZpZyk7XHJcblxyXG5cclxuZm9ybVZhbGlkYXRvcnNbIHByb2ZpbGVGb3JtLmdldEF0dHJpYnV0ZSgnbmFtZScpIF0ucmVzZXRWYWxpZGF0aW9uKCk7XHJcbmZvcm1WYWxpZGF0b3JzWydwcm9maWxlLWZvcm0nXS5yZXNldFZhbGlkYXRpb24oKTsqL1xyXG5cclxuLy8gLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tXHJcbi8vIC0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLVxyXG4vLyAtLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS1cclxuXHJcbmNvbnN0IHBvcHVwSW1hZ2UgPSBuZXcgUG9wdXBXaXRoSW1hZ2UoeyBwb3B1cFNlbGVjdG9yOiBcIiNwaWN0dXJlLXBvcHVwXCIgfSk7XHJcbnBvcHVwSW1hZ2Uuc2V0RXZlbnRMaXN0ZW5lcnMoKTtcclxuXHJcbmNvbnN0IGRlbGV0ZVBvcHVwID0gbmV3IFBvcHVwV2l0aENvbmZpcm1hdGlvbihcIiNkZWxldGUtY2FyZFwiLCB7XHJcbiAgYnV0dG9uVGV4dDogXCJZZXNcIixcclxuICBsb2FkaW5nQnV0dG9uVGV4dDogXCJEZWxldGluZy4uLlwiLFxyXG59KTtcclxuZGVsZXRlUG9wdXAuc2V0RXZlbnRMaXN0ZW5lcnMoKTtcclxuXHJcbmNvbnN0IGFwaSA9IG5ldyBBcGkoe1xyXG4gIGJhc2VVcmw6IFwiaHR0cHM6Ly9hcm91bmQubm9tb3JlcGFydGllcy5jby92MS9ncm91cC0xMi9cIixcclxuICBhdXRob3JpemF0aW9uSUQ6IFwiM2Q1ZDQ1YzctNmI3ZC00MGZhLWIzYWMtNmQ0NjRkNzFmNTkyXCIsXHJcbn0pO1xyXG5cclxubGV0IHVzZXJJZDtcclxuXHJcblByb21pc2UuYWxsKFthcGkuZ2V0VXNlckluZm9ybWF0aW9uKCksIGFwaS5nZXRJbml0aWFsQ2FyZHMoKV0pXHJcbiAgLnRoZW4oKFt1c2VyLCBjYXJkc10pID0+IHtcclxuICAgIHVzZXJJbmZvLnNldFVzZXJJbmZvKHVzZXIubmFtZSwgdXNlci5hYm91dCk7XHJcbiAgICB1c2VySW5mby5zZXRBdmF0YXIodXNlci5hdmF0YXIpO1xyXG4gICAgdXNlcklkID0gdXNlci5faWQ7XHJcbiAgICAvLyBpbml0aWFsaXplIGNhcmRzIHNlY3Rpb25cclxuICAgIGNhcmRTZWN0aW9uID0gbmV3IFNlY3Rpb24oXHJcbiAgICAgIHtcclxuICAgICAgICBpdGVtczogY2FyZHMsXHJcbiAgICAgICAgcmVuZGVyZXI6IChpdGVtKSA9PiBjcmVhdGVDYXJkKGl0ZW0sIGl0ZW0ub3duZXIuX2lkID09PSB1c2VySWQpLFxyXG4gICAgICB9LFxyXG4gICAgICBcIi5jYXJkc19fbGlzdFwiXHJcbiAgICApO1xyXG5cclxuICAgIGNhcmRTZWN0aW9uLnJlbmRlckl0ZW1zKCk7XHJcbiAgfSlcclxuICAuY2F0Y2goKGVycikgPT4gY29uc29sZS5sb2coZXJyKSk7XHJcblxyXG5jb25zdCBoYW5kbGVEZWxldGVDbGljayA9IChjYXJkKSA9PiB7XHJcbiAgZGVsZXRlUG9wdXAuc2V0U3VibWl0QWN0aW9uKCgpID0+IHtcclxuICAgIGRlbGV0ZVBvcHVwLnNob3dMb2FkaW5nKCk7XHJcbiAgICBhcGlcclxuICAgICAgLmRlbGV0ZUNhcmQoY2FyZC5pZClcclxuICAgICAgLnRoZW4oKCkgPT4ge1xyXG4gICAgICAgIGRlbGV0ZVBvcHVwLmNsb3NlKCk7XHJcbiAgICAgICAgY2FyZC5yZW1vdmVDYXJkKCk7XHJcbiAgICAgIH0pXHJcbiAgICAgIC5jYXRjaCgoZXJyKSA9PiBjb25zb2xlLmxvZyhlcnIpKVxyXG4gICAgICAuZmluYWxseSgoKSA9PiB7XHJcbiAgICAgICAgZGVsZXRlUG9wdXAuaGlkZUxvYWRpbmcoKTtcclxuICAgICAgfSk7XHJcbiAgfSk7XHJcbiAgZGVsZXRlUG9wdXAub3BlbigpO1xyXG59O1xyXG5cclxuY29uc3QgaGFuZGxlTGlrZUJ1dHRvbiA9IChjYXJkKSA9PiB7XHJcbiAgaWYgKGNhcmQuaXNMaWtlZCgpKSB7XHJcbiAgICBhcGlcclxuICAgICAgLnJlbW92ZUxpa2UoY2FyZC5pZClcclxuICAgICAgLnRoZW4oKHJlcykgPT4ge1xyXG4gICAgICAgIGNhcmQudXBkYXRlTGlrZXMocmVzLmxpa2VzKTtcclxuICAgICAgfSlcclxuICAgICAgLmNhdGNoKChlcnIpID0+IGNvbnNvbGUubG9nKGVycikpO1xyXG4gIH0gZWxzZSB7XHJcbiAgICBhcGlcclxuICAgICAgLmFkZExpa2UoY2FyZC5pZClcclxuICAgICAgLnRoZW4oKHJlcykgPT4ge1xyXG4gICAgICAgIGNhcmQudXBkYXRlTGlrZXMocmVzLmxpa2VzKTtcclxuICAgICAgfSlcclxuICAgICAgLmNhdGNoKChlcnIpID0+IGNvbnNvbGUubG9nKGVycikpO1xyXG4gIH1cclxufTtcclxuXHJcbmNvbnN0IGNyZWF0ZUNhcmQgPSAoY2FyZERhdGEpID0+IHtcclxuICBjb25zdCBjYXJkID0gbmV3IENhcmQoXHJcbiAgICBjYXJkRGF0YSxcclxuICAgIHVzZXJJZCxcclxuICAgIGNhcmREYXRhLm93bmVyLl9pZCA9PT0gdXNlcklkLFxyXG4gICAgXCIudGVtcGxhdGVcIixcclxuICAgIChkYXRhKSA9PiB7XHJcbiAgICAgIHBvcHVwSW1hZ2Uub3BlbihkYXRhKTtcclxuICAgIH0sXHJcbiAgICBoYW5kbGVEZWxldGVDbGljayxcclxuICAgIGhhbmRsZUxpa2VCdXR0b25cclxuICApO1xyXG4gIHJldHVybiBjYXJkLmdldFZpZXcoKTtcclxufTtcclxuXHJcbmNvbnN0IHByb2ZpbGVQb3B1cCA9IG5ldyBQb3B1cFdpdGhGb3JtKFwiI3Byb2ZpbGUtcG9wdXBcIiwge1xyXG4gIGhhbmRsZVN1Ym1pdDogKGlucHV0VmFsdWVzKSA9PiB7XHJcbiAgICBwcm9maWxlUG9wdXAuc2hvd0xvYWRpbmcoKTtcclxuICAgIGFwaVxyXG4gICAgICAuZWRpdFByb2ZpbGUoeyBuYW1lOiBpbnB1dFZhbHVlcy5uYW1lLCBhYm91dDogaW5wdXRWYWx1ZXMuZGVzY3JpcHRpb24gfSlcclxuICAgICAgLnRoZW4oKHJlcykgPT4ge1xyXG4gICAgICAgIHVzZXJJbmZvLnNldFVzZXJJbmZvKHJlcy5uYW1lLCByZXMuYWJvdXQpO1xyXG4gICAgICAgIHByb2ZpbGVQb3B1cC5jbG9zZSgpO1xyXG4gICAgICB9KVxyXG4gICAgICAuY2F0Y2goKGVycikgPT4gY29uc29sZS5sb2coZXJyKSlcclxuICAgICAgLmZpbmFsbHkoKCkgPT4ge1xyXG4gICAgICAgIHByb2ZpbGVQb3B1cC5oaWRlTG9hZGluZygpO1xyXG4gICAgICB9KTtcclxuICB9LFxyXG4gIGJ1dHRvblRleHQ6IFwiU2F2ZVwiLFxyXG4gIGxvYWRpbmdCdXR0b25UZXh0OiBcIlNhdmluZy4uXCIsXHJcbn0pO1xyXG5cclxuY29uc3QgY2FyZFBvcHVwID0gbmV3IFBvcHVwV2l0aEZvcm0oXCIjYWRkLWNhcmQtcG9wdXBcIiwge1xyXG4gIGhhbmRsZVN1Ym1pdDogKGlucHV0VmFsdWVzKSA9PiB7XHJcbiAgICBjYXJkUG9wdXAuc2hvd0xvYWRpbmcoKTtcclxuICAgIGFwaVxyXG4gICAgICAuYWRkTmV3Q2FyZCh7IG5hbWU6IGlucHV0VmFsdWVzLnRpdGxlLCBsaW5rOiBpbnB1dFZhbHVlcy5pbWFnZSB9KVxyXG4gICAgICAudGhlbigocmVzKSA9PiB7XHJcbiAgICAgICAgY29uc3QgY2FyZCA9IGNyZWF0ZUNhcmQocmVzKTtcclxuICAgICAgICBjYXJkU2VjdGlvbi5hZGRJdGVtKGNhcmQpO1xyXG4gICAgICAgIGNhcmRQb3B1cC5jbG9zZSgpO1xyXG4gICAgICB9KVxyXG4gICAgICAuY2F0Y2goKGVycikgPT4gY29uc29sZS5sb2coZXJyKSlcclxuICAgICAgLmZpbmFsbHkoKCkgPT4ge1xyXG4gICAgICAgIGNhcmRQb3B1cC5oaWRlTG9hZGluZygpO1xyXG4gICAgICB9KTtcclxuICB9LFxyXG4gIGJ1dHRvblRleHQ6IFwiQ3JlYXRlXCIsXHJcbiAgbG9hZGluZ0J1dHRvblRleHQ6IFwiQ3JlYXRpbmcuLi5cIixcclxufSk7XHJcbi8vLy8vLy8vLy8vLy8vLy8vLy8vLy8vLy8vLy8vLy8vLy8vLy8vLy8vLy8vLy8vLy8vLy8vLy8vLy8vLy8vLy8vLy8vLy8vLy8vLy8vLy8vLy8vLy8vLy8vLy8vLy8vLy8vLy8vLy8vLy8vLy8vLy8vLy8vLy8vLy8vLy8vLy9cclxuLy8vLy8vLy8vLy8vLy8vLy8vLy8vLy8vLy8vLy8vLy8vLy8vLy8vLy8vLy8vLy8vLy8vLy8vLy8vLy8vLy8vLy8vLy8vLy8vLy8vLy8vLy8vLy8vLy8vLy8vLy8vLy8vLy8vLy8vLy8vLy8vLy8vLy8vLy8vLy8vLy8vLy8vXHJcblxyXG5jb25zdCBwcm9maWxlUGljdHVyZSA9IG5ldyBQb3B1cFdpdGhGb3JtKFwiI2NoYW5nZS1wcm9maWxlLXBpY1wiLCB7XHJcbiAgaGFuZGxlU3VibWl0OiAoaW5wdXRWYWx1ZSkgPT4ge1xyXG4gICAgcHJvZmlsZVBpY3R1cmUuc2hvd0xvYWRpbmcoKTtcclxuICAgIGFwaVxyXG4gICAgICAudXBkYXRlUHJvZlBpYyhpbnB1dFZhbHVlLmltYWdlKVxyXG4gICAgICAudGhlbigocmVzKSA9PiB7XHJcbiAgICAgICAgLy9jaGFuZ2VQaWNWYWxpZGF0b3IuZGlzYWJsZUJ1dHRvbigpO1xyXG4gICAgICAgIHVzZXJJbmZvLnNldEF2YXRhcihyZXMuYXZhdGFyKTtcclxuICAgICAgICBwcm9maWxlUGljdHVyZS5jbG9zZSgpO1xyXG4gICAgICB9KVxyXG4gICAgICAuY2F0Y2goKGVycikgPT4gY29uc29sZS5sb2coZXJyKSlcclxuICAgICAgLmZpbmFsbHkoKCkgPT4ge1xyXG4gICAgICAgIHByb2ZpbGVQaWN0dXJlLmhpZGVMb2FkaW5nKCk7XHJcbiAgICAgIH0pO1xyXG4gIH0sXHJcbiAgYnV0dG9uVGV4dDogXCJTYXZlXCIsXHJcbiAgbG9hZGluZ0J1dHRvblRleHQ6IFwiU2F2aW5nLi5cIixcclxufSk7XHJcblxyXG5wcm9maWxlSW1hZ2VCdXR0b24uYWRkRXZlbnRMaXN0ZW5lcihcImNsaWNrXCIsICgpID0+IHtcclxuICBjaGFuZ2VQaWNWYWxpZGF0b3IuZGlzYWJsZUJ1dHRvbigpO1xyXG4gIHByb2ZpbGVQaWN0dXJlLm9wZW4oKTtcclxufSk7XHJcblxyXG4vLy8vLy8vLy8vLy8vLy8vLy8vLy8vLy8vLy8vLy8vLy8vLy8vLy8vLy8vLy8vLy8vLy8vLy8vLy8vLy8vLy8vLy8vLy8vLy8vLy8vLy8vLy8vLy8vLy8vLy8vLy8vLy8vLy8vLy8vLy8vLy8vLy8vLy8vLy8vLy8vLy8vLy8vXHJcbi8vLy8vLy8vLy8vLy8vLy8vLy8vLy8vLy8vLy8vLy8vLy8vLy8vLy8vLy8vLy8vLy8vLy8vLy8vLy8vLy8vLy8vLy8vLy8vLy8vLy8vLy8vLy8vLy8vLy8vLy8vLy8vLy8vLy8vLy8vLy8vLy8vLy8vLy8vLy8vLy8vLy8vLy9cclxuY29uc3QgdXNlckluZm8gPSBuZXcgVXNlckluZm8oe1xyXG4gIG5hbWVTZWxlY3RvcjogXCIucHJvZmlsZV9fdGl0bGVcIixcclxuICBqb2JTZWxlY3RvcjogXCIucHJvZmlsZV9fZGVzY3JpcHRpb25cIixcclxuICBhdmF0YXJTZWxlY3RvcjogXCIucHJvZmlsZV9faW1hZ2VcIixcclxufSk7XHJcblxyXG5jYXJkUG9wdXAuc2V0RXZlbnRMaXN0ZW5lcnMoKTtcclxucHJvZmlsZVBvcHVwLnNldEV2ZW50TGlzdGVuZXJzKCk7XHJcbnByb2ZpbGVQaWN0dXJlLnNldEV2ZW50TGlzdGVuZXJzKCk7XHJcblxyXG5wcm9maWxlQWRkQnV0dG9uLmFkZEV2ZW50TGlzdGVuZXIoXCJjbGlja1wiLCAoKSA9PiB7XHJcbiAgY2FyZFBvcHVwLm9wZW4oKTtcclxuICBhZGRGb3JtVmFsaWRhdG9yLmRpc2FibGVCdXR0b24oKTtcclxufSk7XHJcbnByb2ZpbGVFZGl0QnV0dG9uLmFkZEV2ZW50TGlzdGVuZXIoXCJjbGlja1wiLCAoKSA9PiB7XHJcbiAgZWRpdEZvcm1WYWxpZGF0b3IuZGlzYWJsZUJ1dHRvbigpO1xyXG4gIHByb2ZpbGVQb3B1cC5vcGVuKCk7XHJcbiAgY29uc3QgdXNlckRhdGEgPSB1c2VySW5mby5nZXRVc2VySW5mbygpO1xyXG4gIG5hbWVJbnB1dC52YWx1ZSA9IHVzZXJEYXRhLm5hbWU7XHJcbiAgam9iSW5wdXQudmFsdWUgPSB1c2VyRGF0YS5kZXNjcmlwdGlvbjtcclxufSk7XHJcbiIsImltcG9ydCBQb3B1cCBmcm9tIFwiLi9Qb3B1cC5qc1wiO1xyXG5leHBvcnQgZGVmYXVsdCBjbGFzcyBQb3B1cFdpdGhJbWFnZSBleHRlbmRzIFBvcHVwIHtcclxuICBvcGVuKHsgbGluaywgbmFtZSB9KSB7XHJcbiAgICBjb25zdCBpbWFnZSA9IHRoaXMuX3BvcHVwRWxlbWVudC5xdWVyeVNlbGVjdG9yKFwiLm1vZGFsX19pbWFnZS1jbGlja2VkXCIpO1xyXG4gICAgY29uc3QgaW1hZ2VUZXh0ID0gdGhpcy5fcG9wdXBFbGVtZW50LnF1ZXJ5U2VsZWN0b3IoXCIubW9kYWxfX2ltYWdlLXRleHRcIik7XHJcbiAgICBpbWFnZS5zcmMgPSBsaW5rO1xyXG4gICAgaW1hZ2VUZXh0LmFsdCA9IG5hbWU7XHJcbiAgICBpbWFnZVRleHQudGV4dENvbnRlbnQgPSBuYW1lO1xyXG4gICAgc3VwZXIub3BlbigpO1xyXG4gIH1cclxufVxyXG4iLCJpbXBvcnQgUG9wdXAgZnJvbSBcIi4vUG9wdXAuanNcIjtcclxuXHJcbmV4cG9ydCBkZWZhdWx0IGNsYXNzIFBvcHVwV2l0aENvbmZpcm1hdGlvbiBleHRlbmRzIFBvcHVwIHtcclxuICBjb25zdHJ1Y3Rvcihwb3B1cFNlbGVjdG9yLCB7IGJ1dHRvblRleHQsIGxvYWRpbmdCdXR0b25UZXh0IH0pIHtcclxuICAgIHN1cGVyKHsgcG9wdXBTZWxlY3RvciB9KTtcclxuICAgIHRoaXMuX3BvcHVwRm9ybSA9IHRoaXMuX3BvcHVwRWxlbWVudC5xdWVyeVNlbGVjdG9yKFwiLm1vZGFsX19mb3JtXCIpO1xyXG4gICAgdGhpcy5fcG9wdXBDb25maXJtYXRpb25CdXR0b24gPVxyXG4gICAgICB0aGlzLl9wb3B1cEZvcm0ucXVlcnlTZWxlY3RvcihcIi5tb2RhbF9fYnV0dG9uXCIpO1xyXG4gICAgdGhpcy5fYnV0dG9uVGV4dCA9IGJ1dHRvblRleHQ7XHJcbiAgICB0aGlzLl9sb2FkaW5nQnV0dG9uVGV4dCA9IGxvYWRpbmdCdXR0b25UZXh0O1xyXG4gIH1cclxuXHJcbiAgc2V0RXZlbnRMaXN0ZW5lcnMoKSB7XHJcbiAgICB0aGlzLl9wb3B1cEZvcm0uYWRkRXZlbnRMaXN0ZW5lcihcInN1Ym1pdFwiLCAoZXZ0KSA9PiB7XHJcbiAgICAgIGV2dC5wcmV2ZW50RGVmYXVsdCgpO1xyXG4gICAgICB0aGlzLl9oYW5kbGVDb25maXJtYXRpb24oKTtcclxuICAgIH0pO1xyXG4gICAgc3VwZXIuc2V0RXZlbnRMaXN0ZW5lcnMoKTtcclxuICB9XHJcblxyXG4gIHNldFN1Ym1pdEFjdGlvbihjYWxsYmFjaykge1xyXG4gICAgdGhpcy5faGFuZGxlQ29uZmlybWF0aW9uID0gY2FsbGJhY2s7XHJcbiAgfVxyXG5cclxuICBzaG93TG9hZGluZygpIHtcclxuICAgIHRoaXMuX3BvcHVwQ29uZmlybWF0aW9uQnV0dG9uLnRleHRDb250ZW50ID0gdGhpcy5fbG9hZGluZ0J1dHRvblRleHQ7XHJcbiAgfVxyXG5cclxuICBoaWRlTG9hZGluZygpIHtcclxuICAgIHRoaXMuX3BvcHVwQ29uZmlybWF0aW9uQnV0dG9uLnRleHRDb250ZW50ID0gdGhpcy5fYnV0dG9uVGV4dDtcclxuICB9XHJcblxyXG4gIGNsb3NlKCkge1xyXG4gICAgdGhpcy5fcG9wdXBGb3JtLnJlc2V0KCk7XHJcbiAgICBzdXBlci5jbG9zZSgpO1xyXG4gIH1cclxufVxyXG4iLCJleHBvcnQgZGVmYXVsdCBjbGFzcyBBcGkge1xyXG4gIGNvbnN0cnVjdG9yKHsgYmFzZVVybCwgYXV0aG9yaXphdGlvbklEIH0pIHtcclxuICAgIHRoaXMuX2Jhc2VVcmwgPSBiYXNlVXJsO1xyXG4gICAgdGhpcy5faGVhZGVyID0ge1xyXG4gICAgICBhdXRob3JpemF0aW9uOiBhdXRob3JpemF0aW9uSUQsXHJcbiAgICAgIFwiQ29udGVudC1UeXBlXCI6IFwiYXBwbGljYXRpb24vanNvblwiLFxyXG4gICAgfTtcclxuICB9XHJcblxyXG4gIF9wcm9jZXNzUmVzcG9uc2VTZXJ2ZXIgPSAocmVzKSA9PiB7XHJcbiAgICBpZiAocmVzLm9rKSB7XHJcbiAgICAgIHJldHVybiByZXMuanNvbigpO1xyXG4gICAgfVxyXG4gICAgcmV0dXJuIFByb21pc2UucmVqZWN0KGBFcnJvcjogJHtyZXMuc3RhdHVzfWApO1xyXG4gIH07XHJcblxyXG4gIGdldFVzZXJJbmZvcm1hdGlvbigpIHtcclxuICAgIHJldHVybiBmZXRjaChgJHt0aGlzLl9iYXNlVXJsfXVzZXJzL21lYCwge1xyXG4gICAgICBoZWFkZXJzOiB0aGlzLl9oZWFkZXIsXHJcbiAgICB9KS50aGVuKHRoaXMuX3Byb2Nlc3NSZXNwb25zZVNlcnZlcik7XHJcbiAgfVxyXG5cclxuICBnZXRJbml0aWFsQ2FyZHMoKSB7XHJcbiAgICByZXR1cm4gZmV0Y2goYCR7dGhpcy5fYmFzZVVybH1jYXJkc2AsIHtcclxuICAgICAgaGVhZGVyczogdGhpcy5faGVhZGVyLFxyXG4gICAgfSkudGhlbih0aGlzLl9wcm9jZXNzUmVzcG9uc2VTZXJ2ZXIpO1xyXG4gIH1cclxuXHJcbiAgZWRpdFByb2ZpbGUoeyBuYW1lLCBhYm91dCB9KSB7XHJcbiAgICByZXR1cm4gZmV0Y2goYCR7dGhpcy5fYmFzZVVybH11c2Vycy9tZWAsIHtcclxuICAgICAgbWV0aG9kOiBcIlBBVENIXCIsXHJcbiAgICAgIGhlYWRlcnM6IHRoaXMuX2hlYWRlcixcclxuICAgICAgYm9keTogSlNPTi5zdHJpbmdpZnkoe1xyXG4gICAgICAgIG5hbWUsXHJcbiAgICAgICAgYWJvdXQsXHJcbiAgICAgIH0pLFxyXG4gICAgfSkudGhlbih0aGlzLl9wcm9jZXNzUmVzcG9uc2VTZXJ2ZXIpO1xyXG4gIH1cclxuXHJcbiAgYWRkTmV3Q2FyZCh7IG5hbWUsIGxpbmsgfSkge1xyXG4gICAgcmV0dXJuIGZldGNoKGAke3RoaXMuX2Jhc2VVcmx9Y2FyZHNgLCB7XHJcbiAgICAgIG1ldGhvZDogXCJQT1NUXCIsXHJcbiAgICAgIGhlYWRlcnM6IHRoaXMuX2hlYWRlcixcclxuICAgICAgYm9keTogSlNPTi5zdHJpbmdpZnkoe1xyXG4gICAgICAgIG5hbWUsXHJcbiAgICAgICAgbGluayxcclxuICAgICAgfSksXHJcbiAgICB9KS50aGVuKHRoaXMuX3Byb2Nlc3NSZXNwb25zZVNlcnZlcik7XHJcbiAgfVxyXG5cclxuICBkZWxldGVDYXJkKGlkKSB7XHJcbiAgICByZXR1cm4gZmV0Y2goYCR7dGhpcy5fYmFzZVVybH1jYXJkcy8ke2lkfWAsIHtcclxuICAgICAgbWV0aG9kOiBcIkRFTEVURVwiLFxyXG4gICAgICBoZWFkZXJzOiB0aGlzLl9oZWFkZXIsXHJcbiAgICB9KS50aGVuKHRoaXMuX3Byb2Nlc3NSZXNwb25zZVNlcnZlcik7XHJcbiAgfVxyXG5cclxuICB1cGRhdGVQcm9mUGljKGF2YXRhcikge1xyXG4gICAgcmV0dXJuIGZldGNoKGAke3RoaXMuX2Jhc2VVcmx9dXNlcnMvbWUvYXZhdGFyYCwge1xyXG4gICAgICBtZXRob2Q6IFwiUEFUQ0hcIixcclxuICAgICAgaGVhZGVyczogdGhpcy5faGVhZGVyLFxyXG4gICAgICBib2R5OiBKU09OLnN0cmluZ2lmeSh7XHJcbiAgICAgICAgYXZhdGFyLFxyXG4gICAgICB9KSxcclxuICAgIH0pLnRoZW4odGhpcy5fcHJvY2Vzc1Jlc3BvbnNlU2VydmVyKTtcclxuICB9XHJcblxyXG4gIGFkZExpa2UoaWQpIHtcclxuICAgIHJldHVybiBmZXRjaChgJHt0aGlzLl9iYXNlVXJsfWNhcmRzL2xpa2VzLyR7aWR9YCwge1xyXG4gICAgICBtZXRob2Q6IFwiUFVUXCIsXHJcbiAgICAgIGhlYWRlcnM6IHRoaXMuX2hlYWRlcixcclxuICAgIH0pLnRoZW4odGhpcy5fcHJvY2Vzc1Jlc3BvbnNlU2VydmVyKTtcclxuICB9XHJcblxyXG4gIHJlbW92ZUxpa2UoaWQpIHtcclxuICAgIHJldHVybiBmZXRjaChgJHt0aGlzLl9iYXNlVXJsfWNhcmRzL2xpa2VzLyR7aWR9YCwge1xyXG4gICAgICBtZXRob2Q6IFwiREVMRVRFXCIsXHJcbiAgICAgIGhlYWRlcnM6IHRoaXMuX2hlYWRlcixcclxuICAgIH0pLnRoZW4odGhpcy5fcHJvY2Vzc1Jlc3BvbnNlU2VydmVyKTtcclxuICB9XHJcbn1cclxuIiwiY2xhc3MgQ2FyZCB7XHJcbiAgY29uc3RydWN0b3IoXHJcbiAgICBkYXRhLFxyXG4gICAgdXNlcklkLFxyXG4gICAgaXNPd25lcixcclxuICAgIGNhcmRTZWxlY3RvcixcclxuICAgIGhhbmRsZUNhcmRDbGljayxcclxuICAgIGhhbmRsZURlbGV0ZUNhcmQsXHJcbiAgICBoYW5kbGVMaWtlQnV0dG9uXHJcbiAgKSB7XHJcbiAgICB0aGlzLl90ZXh0ID0gZGF0YS5uYW1lO1xyXG4gICAgdGhpcy5fbGluayA9IGRhdGEubGluaztcclxuICAgIHRoaXMuaWQgPSBkYXRhLl9pZDtcclxuICAgIHRoaXMuX3VzZXJJZCA9IHVzZXJJZDtcclxuICAgIHRoaXMuX2lzT3duZXIgPSBpc093bmVyO1xyXG4gICAgdGhpcy5fbGlrZXMgPSBkYXRhLmxpa2VzO1xyXG4gICAgdGhpcy5fY2FyZFNlbGVjdG9yID0gY2FyZFNlbGVjdG9yO1xyXG4gICAgdGhpcy5faGFuZGxlQ2FyZENsaWNrID0gaGFuZGxlQ2FyZENsaWNrO1xyXG4gICAgdGhpcy5faGFuZGxlRGVsZXRlQ2FyZCA9IGhhbmRsZURlbGV0ZUNhcmQ7XHJcbiAgICB0aGlzLl9oYW5kbGVMaWtlQnV0dG9uID0gaGFuZGxlTGlrZUJ1dHRvbjtcclxuICB9XHJcblxyXG4gIF9zZXRFdmVudExpc3RlbmVycygpIHtcclxuICAgIHRoaXMuX2VsZW1lbnRcclxuICAgICAgLnF1ZXJ5U2VsZWN0b3IoXCIuY2FyZF9fbGlrZS1idXR0b25cIilcclxuICAgICAgLmFkZEV2ZW50TGlzdGVuZXIoXCJjbGlja1wiLCAoKSA9PiB0aGlzLl9oYW5kbGVMaWtlQnV0dG9uKHRoaXMpKTtcclxuXHJcbiAgICB0aGlzLl90cmFzaEJ1dHRvbiA9IHRoaXMuX2VsZW1lbnQucXVlcnlTZWxlY3RvcihcIi5jYXJkX190cmFzaC1idXR0b25cIik7XHJcbiAgICB0aGlzLl90cmFzaEJ1dHRvbi5hZGRFdmVudExpc3RlbmVyKFwiY2xpY2tcIiwgKCkgPT5cclxuICAgICAgdGhpcy5faGFuZGxlRGVsZXRlQ2FyZCh0aGlzKVxyXG4gICAgKTtcclxuXHJcbiAgICB0aGlzLl9lbGVtZW50XHJcbiAgICAgIC5xdWVyeVNlbGVjdG9yKFwiLmNhcmRfX2ltYWdlXCIpXHJcbiAgICAgIC5hZGRFdmVudExpc3RlbmVyKFwiY2xpY2tcIiwgKCkgPT5cclxuICAgICAgICB0aGlzLl9oYW5kbGVDYXJkQ2xpY2soeyBuYW1lOiB0aGlzLl90ZXh0LCBsaW5rOiB0aGlzLl9saW5rIH0pXHJcbiAgICAgICk7XHJcbiAgfVxyXG5cclxuICBsaWtlKCkge1xyXG4gICAgdGhpcy5fZWxlbWVudFxyXG4gICAgICAucXVlcnlTZWxlY3RvcihcIi5jYXJkX19saWtlLWJ1dHRvblwiKVxyXG4gICAgICAuY2xhc3NMaXN0LmFkZChcImNhcmRfX2xpa2UtYnV0dG9uX2FjdGl2ZVwiKTtcclxuICB9XHJcblxyXG4gIHVubGlrZSgpIHtcclxuICAgIHRoaXMuX2VsZW1lbnRcclxuICAgICAgLnF1ZXJ5U2VsZWN0b3IoXCIuY2FyZF9fbGlrZS1idXR0b25cIilcclxuICAgICAgLmNsYXNzTGlzdC5yZW1vdmUoXCJjYXJkX19saWtlLWJ1dHRvbl9hY3RpdmVcIik7XHJcbiAgfVxyXG5cclxuICBpc0xpa2VkKCkge1xyXG4gICAgcmV0dXJuIHRoaXMuX2xpa2VzLmZpbmQoKHsgX2lkIH0pID0+IHRoaXMuX3VzZXJJZCA9PT0gX2lkKTtcclxuICB9XHJcblxyXG4gIHVwZGF0ZUxpa2VzKGxpa2VzKSB7XHJcbiAgICB0aGlzLl9saWtlcyA9IGxpa2VzO1xyXG4gICAgdGhpcy5yZW5kZXJMaWtlcygpO1xyXG4gIH1cclxuXHJcbiAgcmVuZGVyTGlrZXMoKSB7XHJcbiAgICBjb25zdCBjYXJkTGlrZU51bWJlciA9IHRoaXMuX2VsZW1lbnQucXVlcnlTZWxlY3RvcihcIi5jYXJkX19saWtlLW51bWJlclwiKTtcclxuICAgIGNhcmRMaWtlTnVtYmVyLnRleHRDb250ZW50ID0gdGhpcy5fbGlrZXMubGVuZ3RoO1xyXG4gICAgaWYgKHRoaXMuaXNMaWtlZCh0aGlzLl91c2VySWQpKSB7XHJcbiAgICAgIHRoaXMubGlrZSgpO1xyXG4gICAgfSBlbHNlIHtcclxuICAgICAgdGhpcy51bmxpa2UoKTtcclxuICAgIH1cclxuICB9XHJcblxyXG4gIF9nZXRUZW1wbGF0ZSgpIHtcclxuICAgIHJldHVybiBkb2N1bWVudFxyXG4gICAgICAucXVlcnlTZWxlY3Rvcih0aGlzLl9jYXJkU2VsZWN0b3IpXHJcbiAgICAgIC5jb250ZW50LnF1ZXJ5U2VsZWN0b3IoXCIuY2FyZFwiKVxyXG4gICAgICAuY2xvbmVOb2RlKHRydWUpO1xyXG4gIH1cclxuXHJcbiAgZ2V0VmlldygpIHtcclxuICAgIHRoaXMuX2VsZW1lbnQgPSB0aGlzLl9nZXRUZW1wbGF0ZSgpO1xyXG4gICAgdGhpcy5fc2V0RXZlbnRMaXN0ZW5lcnMoKTtcclxuICAgIGNvbnN0IGNhcmRJbWFnZSA9IHRoaXMuX2VsZW1lbnQucXVlcnlTZWxlY3RvcihcIi5jYXJkX19pbWFnZVwiKTtcclxuICAgIGNvbnN0IGNhcmRUZXh0ID0gdGhpcy5fZWxlbWVudC5xdWVyeVNlbGVjdG9yKFwiLmNhcmRfX3RleHRcIik7XHJcbiAgICB0aGlzLnJlbmRlckxpa2VzKCk7XHJcbiAgICBjYXJkSW1hZ2Uuc3JjID0gdGhpcy5fbGluaztcclxuICAgIGNhcmRJbWFnZS5hbHQgPSB0aGlzLl90ZXh0O1xyXG4gICAgY2FyZFRleHQudGV4dENvbnRlbnQgPSB0aGlzLl90ZXh0O1xyXG4gICAgaWYgKHRoaXMuX2lzT3duZXIpIHtcclxuICAgICAgdGhpcy5fdHJhc2hCdXR0b24uY2xhc3NMaXN0LmFkZChcImNhcmRfX3RyYXNoX3Zpc2libGVcIik7XHJcbiAgICB9XHJcbiAgICByZXR1cm4gdGhpcy5fZWxlbWVudDtcclxuICB9XHJcblxyXG4gIHJlbW92ZUNhcmQoKSB7XHJcbiAgICB0aGlzLl9lbGVtZW50LnJlbW92ZSgpO1xyXG4gICAgdGhpcy5fZWxlbWVudC5udWxsO1xyXG4gIH1cclxufVxyXG5cclxuZXhwb3J0IGRlZmF1bHQgQ2FyZDtcclxuIiwiZXhwb3J0IGRlZmF1bHQgY2xhc3MgVXNlckluZm8ge1xyXG4gIGNvbnN0cnVjdG9yKHsgbmFtZVNlbGVjdG9yLCBqb2JTZWxlY3RvciwgYXZhdGFyU2VsZWN0b3IgfSkge1xyXG4gICAgdGhpcy5fbmFtZUVsZW1lbnQgPSBkb2N1bWVudC5xdWVyeVNlbGVjdG9yKG5hbWVTZWxlY3Rvcik7XHJcbiAgICB0aGlzLl9qb2JFbGVtZW50ID0gZG9jdW1lbnQucXVlcnlTZWxlY3Rvcihqb2JTZWxlY3Rvcik7XHJcbiAgICB0aGlzLl9hdmF0YXJFbGVtZW50ID0gZG9jdW1lbnQucXVlcnlTZWxlY3RvcihhdmF0YXJTZWxlY3Rvcik7XHJcbiAgfVxyXG5cclxuICBnZXRVc2VySW5mbygpIHtcclxuICAgIGNvbnN0IHVzZXJEYXRhID0ge1xyXG4gICAgICBuYW1lOiB0aGlzLl9uYW1lRWxlbWVudC50ZXh0Q29udGVudCxcclxuICAgICAgZGVzY3JpcHRpb246IHRoaXMuX2pvYkVsZW1lbnQudGV4dENvbnRlbnQsXHJcbiAgICB9O1xyXG4gICAgcmV0dXJuIHVzZXJEYXRhO1xyXG4gIH1cclxuXHJcbiAgc2V0VXNlckluZm8obmFtZSwgam9iKSB7XHJcbiAgICB0aGlzLl9uYW1lRWxlbWVudC50ZXh0Q29udGVudCA9IG5hbWU7XHJcbiAgICB0aGlzLl9qb2JFbGVtZW50LnRleHRDb250ZW50ID0gam9iO1xyXG4gIH1cclxuXHJcbiAgc2V0QXZhdGFyKGF2YXRhcikge1xyXG4gICAgdGhpcy5fYXZhdGFyRWxlbWVudC5zcmMgPSBhdmF0YXI7XHJcbiAgfVxyXG59XHJcbiJdLCJuYW1lcyI6WyJjb25zdHJ1Y3RvciIsInNldHRpbmdzIiwiZm9ybUVsZW1lbnQiLCJ0aGlzIiwiX2lucHV0U2VsZWN0b3IiLCJpbnB1dFNlbGVjdG9yIiwiX3N1Ym1pdEJ1dHRvblNlbGVjdG9yIiwic3VibWl0QnV0dG9uU2VsZWN0b3IiLCJfaW5hY3RpdmVCdXR0b25DbGFzcyIsImluYWN0aXZlQnV0dG9uQ2xhc3MiLCJfaW5wdXRFcnJvckNsYXNzIiwiaW5wdXRFcnJvckNsYXNzIiwiX2Vycm9yQ2xhc3MiLCJlcnJvckNsYXNzIiwiX2Zvcm0iLCJfc2hvd0lucHV0RXJyb3IiLCJpbnB1dEVsIiwiZXJyb3JNZXNzYWdlRWwiLCJxdWVyeVNlbGVjdG9yIiwiaWQiLCJjbGFzc0xpc3QiLCJhZGQiLCJ0ZXh0Q29udGVudCIsInZhbGlkYXRpb25NZXNzYWdlIiwiX2hpZGVJbnB1dEVycm9yIiwicmVtb3ZlIiwiX3RvZ2dsZUJ1dHRvblN0YXRlIiwiX2hhc0ludmFsaWRJbnB1dCIsImRpc2FibGVCdXR0b24iLCJfZW5hYmxlQnV0dG9uIiwiX2lucHV0TGlzdCIsImV2ZXJ5IiwidmFsaWRpdHkiLCJ2YWxpZCIsIl9jaGVja0lucHV0VmFsaWRpdHkiLCJfc3VibWl0QnV0dG9uIiwiZGlzYWJsZWQiLCJfc2V0RXZlbnRMaXN0ZW5lcnMiLCJxdWVyeVNlbGVjdG9yQWxsIiwiZm9yRWFjaCIsImFkZEV2ZW50TGlzdGVuZXIiLCJlIiwiZW5hYmxlVmFsaWRhdGlvbiIsInByZXZlbnREZWZhdWx0IiwiUG9wdXAiLCJfcmVmIiwicG9wdXBTZWxlY3RvciIsIl9wb3B1cEVsZW1lbnQiLCJkb2N1bWVudCIsIm9wZW4iLCJfaGFuZGxlRXNjQ2xvc2UiLCJjbG9zZSIsInJlbW92ZUV2ZW50TGlzdGVuZXIiLCJldnQiLCJrZXkiLCJzZXRFdmVudExpc3RlbmVycyIsInRhcmdldCIsIm1hdGNoZXMiLCJQb3B1cFdpdGhGb3JtIiwiaGFuZGxlU3VibWl0IiwiYnV0dG9uVGV4dCIsImxvYWRpbmdCdXR0b25UZXh0Iiwic3VwZXIiLCJfcG9wdXBGb3JtIiwiX2hhbmRsZVN1Ym1pdCIsIl9pbnB1dHMiLCJfYnV0dG9uVGV4dCIsIl9sb2FkaW5nQnV0dG9uVGV4dCIsIl9wb3B1cFN1Ym1pdEJ1dHRvbiIsIl9nZXRJbnB1dFZhbHVlcyIsImlucHV0T2JqZWN0IiwiaW5wdXQiLCJuYW1lIiwidmFsdWUiLCJyZXNldCIsImhpZGVMb2FkaW5nIiwic2hvd0xvYWRpbmciLCJwcm9maWxlRWRpdEJ1dHRvbiIsInByb2ZpbGVQb3B1cCIsInByb2ZpbGVGb3JtRWxlbWVudCIsIm5hbWVJbnB1dCIsImpvYklucHV0IiwicHJvZmlsZUFkZEJ1dHRvbiIsImFkZENhcmRQb3B1cCIsImFkZENhcmRQb3B1cEZvcm0iLCJ2YWxpZGF0aW9uU2V0dGluZ3MiLCJwcm9maWxlSW1hZ2VCdXR0b24iLCJjaGFuZ2VQaWNGb3JtIiwiZGVsZXRlQ2FyZEZvcm0iLCJTZWN0aW9uIiwiY29udGFpbmVyIiwiaXRlbXMiLCJyZW5kZXJlciIsIl9pdGVtcyIsIl9yZW5kZXJlciIsIl9jb250YWluZXIiLCJyZW5kZXJJdGVtcyIsIml0ZW0iLCJlbGVtZW50IiwiYWRkSXRlbSIsInByZXBlbmQiLCJjYXJkU2VjdGlvbiIsImVkaXRGb3JtVmFsaWRhdG9yIiwiRm9ybVZhbGlkYXRvciIsImFkZEZvcm1WYWxpZGF0b3IiLCJjaGFuZ2VQaWNWYWxpZGF0b3IiLCJkZWxldGVDYXJkVmFsaWRhdG9yIiwicG9wdXBJbWFnZSIsImxpbmsiLCJpbWFnZSIsImltYWdlVGV4dCIsInNyYyIsImFsdCIsImRlbGV0ZVBvcHVwIiwiX3BvcHVwQ29uZmlybWF0aW9uQnV0dG9uIiwiX2hhbmRsZUNvbmZpcm1hdGlvbiIsInNldFN1Ym1pdEFjdGlvbiIsImNhbGxiYWNrIiwiYXBpIiwiYmFzZVVybCIsImF1dGhvcml6YXRpb25JRCIsIl9iYXNlVXJsIiwiX2hlYWRlciIsImF1dGhvcml6YXRpb24iLCJfcHJvY2Vzc1Jlc3BvbnNlU2VydmVyIiwicmVzIiwib2siLCJqc29uIiwiUHJvbWlzZSIsInJlamVjdCIsInN0YXR1cyIsImdldFVzZXJJbmZvcm1hdGlvbiIsImZldGNoIiwiaGVhZGVycyIsInRoZW4iLCJnZXRJbml0aWFsQ2FyZHMiLCJlZGl0UHJvZmlsZSIsIl9yZWYyIiwiYWJvdXQiLCJtZXRob2QiLCJib2R5IiwiSlNPTiIsInN0cmluZ2lmeSIsImFkZE5ld0NhcmQiLCJfcmVmMyIsImRlbGV0ZUNhcmQiLCJ1cGRhdGVQcm9mUGljIiwiYXZhdGFyIiwiYWRkTGlrZSIsInJlbW92ZUxpa2UiLCJ1c2VySWQiLCJhbGwiLCJ1c2VyIiwiY2FyZHMiLCJ1c2VySW5mbyIsInNldFVzZXJJbmZvIiwic2V0QXZhdGFyIiwiX2lkIiwiY3JlYXRlQ2FyZCIsIm93bmVyIiwiY2F0Y2giLCJlcnIiLCJjb25zb2xlIiwibG9nIiwiaGFuZGxlRGVsZXRlQ2xpY2siLCJjYXJkIiwicmVtb3ZlQ2FyZCIsImZpbmFsbHkiLCJoYW5kbGVMaWtlQnV0dG9uIiwiaXNMaWtlZCIsInVwZGF0ZUxpa2VzIiwibGlrZXMiLCJjYXJkRGF0YSIsImRhdGEiLCJpc093bmVyIiwiY2FyZFNlbGVjdG9yIiwiaGFuZGxlQ2FyZENsaWNrIiwiaGFuZGxlRGVsZXRlQ2FyZCIsIl90ZXh0IiwiX2xpbmsiLCJfdXNlcklkIiwiX2lzT3duZXIiLCJfbGlrZXMiLCJfY2FyZFNlbGVjdG9yIiwiX2hhbmRsZUNhcmRDbGljayIsIl9oYW5kbGVEZWxldGVDYXJkIiwiX2hhbmRsZUxpa2VCdXR0b24iLCJfZWxlbWVudCIsIl90cmFzaEJ1dHRvbiIsImxpa2UiLCJ1bmxpa2UiLCJmaW5kIiwicmVuZGVyTGlrZXMiLCJsZW5ndGgiLCJfZ2V0VGVtcGxhdGUiLCJjb250ZW50IiwiY2xvbmVOb2RlIiwiZ2V0VmlldyIsImNhcmRJbWFnZSIsImNhcmRUZXh0IiwibnVsbCIsImlucHV0VmFsdWVzIiwiZGVzY3JpcHRpb24iLCJjYXJkUG9wdXAiLCJ0aXRsZSIsInByb2ZpbGVQaWN0dXJlIiwiaW5wdXRWYWx1ZSIsIm5hbWVTZWxlY3RvciIsImpvYlNlbGVjdG9yIiwiYXZhdGFyU2VsZWN0b3IiLCJfbmFtZUVsZW1lbnQiLCJfam9iRWxlbWVudCIsIl9hdmF0YXJFbGVtZW50IiwiZ2V0VXNlckluZm8iLCJqb2IiLCJ1c2VyRGF0YSJdLCJzb3VyY2VSb290IjoiIn0=